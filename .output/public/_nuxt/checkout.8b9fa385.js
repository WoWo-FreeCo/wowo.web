import{_ as he}from"./client-only.73480984.js";import{a as fe,j as ye,e as be,b as ge,u as ke,k as Pe}from"./entry.9c028c87.js";import{b as h,c as S,o as Te,q as xe,P as Ce,_ as x,aa as e,F as Ue,V as Ve,y as t,J as r,ah as v,C as i,G as B,ae as _,$ as q,i as I,af as u,a0 as se,ab as E,ai as ne,f as ae,Z as C,a8 as Ie,a9 as Ne}from"./swiper-vue.d582d122.js";import{u as we}from"./authStore.9b58794b.js";import{u as $e}from"./cartStore.459aa100.js";import{r as Oe,s as Se}from"./requestURL.b854792f.js";import{P as N,a as D,D as b,U as R}from"./common.0260327a.js";const p=w=>(Ie("data-v-eb71ab04"),w=w(),Ne(),w),qe={class:"full_height mt185ptb30"},De={id:"checkout_form",action:"javascript:;",class:"cart_container"},Re={class:"cart_list"},Me={class:"cart_img"},Ae=["src"],Le={class:"cart_tl"},Be={class:"product-quantity"},Ee={class:"cart_price text-right"},ze={class:"cart_info"},Fe=p(()=>e("h5",null,"\u5BC4\u9001\u65B9\u5F0F",-1)),Ge={class:"checkout-form"},He={class:"radio form-check"},Ze=["value"],je={class:"radio form-check"},Ke=["value"],Ye={class:"cart_info"},Je=p(()=>e("h5",null,"\u4ED8\u6B3E\u65B9\u5F0F",-1)),Qe={class:"checkout-form"},We={class:"radio form-check"},Xe=["value"],eo={class:"radio form-check"},oo=["value"],to={class:"radio form-check"},so=["value"],no={class:"cart_info"},ao={class:"checkout-form"},ro={id:"ship_home_form",class:"cart_info"},lo=p(()=>e("h5",null,"\u6536\u4EF6\u4EBA\u8CC7\u8A0A",-1)),io={class:"ship_info"},co={class:"cart_info checkout-form"},uo=p(()=>e("h5",null,"\u8D85\u5546\u53D6\u8CA8\u8CC7\u8A0A",-1)),po={class:"store-name"},mo={class:"store-address"},vo={class:"cart_info"},_o=p(()=>e("h5",null,"\u8ACB\u9078\u64C7\u767C\u7968\u9078\u9805",-1)),ho={class:"checkout-form"},fo={class:"radio form-check"},yo={class:"radio form-check"},bo={key:0,class:"cart_info checkout-form"},go=p(()=>e("h5",null,"\u767C\u7968\u8CC7\u8A0A",-1)),ko={class:"ship_info inv-info"},Po={class:"ship_info"},To={class:"cart_info checkout-form"},xo=p(()=>e("h5",null,"\u8F09\u5177\u8CC7\u8A0A",-1)),Co={class:"ship_info inv-info"},Uo={class:"checkbox pt10 pb10"},Vo={key:0,class:"ship_info"},Io={class:"radio form-check"},No=["value"],wo={class:"radio form-check"},$o=["value"],Oo={class:"radio form-check"},So=["value"],qo={class:"cart_info checkout-form"},Do=p(()=>e("h5",null,"\u8A02\u55AE\u5099\u8A3B",-1)),Ro={class:"cart_info"},Mo=p(()=>e("h5",null,"\u4ED8\u6B3E\u660E\u7D30",-1)),Ao={class:"cart_check"},Lo={class:"border_top"},Bo={class:"cart_info checkout-form ptb10"},Eo={class:"checkbox"},zo=p(()=>e("a",{href:"/terms",target:"new"},"\u6703\u54E1\u4F7F\u7528\u689D\u6B3E",-1)),Fo=p(()=>e("a",{href:"/privacy",target:"new"},"\u96B1\u79C1\u6B0A\u653F\u7B56",-1)),Go=p(()=>e("div",{class:"text-center mb-20 mt-20"},[e("span",{id:"errormsg"})],-1)),Ho={class:"text-center mb-20 mt-20"},Zo={__name:"checkout",setup(w){var j,K,Y,J,Q,W,X,ee;const re=ye(),le=be(),f=ge(),$=ke(),l=we(),g=$e(),k=h(0),ie=h(!1),P=h(!1),O=h(!1),m=h(!1),T=h(N.General),M=S({get:()=>U.value.reduce((a,o)=>a+H(o)*o.amount,0),set:a=>{M.value=a}}),z=S(()=>{var a;return((a=l==null?void 0:l.user)==null?void 0:a.rewardCredit)||0}),U=S(()=>{switch(T.value){case N.ColdChain:return g==null?void 0:g.merch.filter(a=>a.attribute==="COLD_CHAIN");default:return g==null?void 0:g.merch.filter(a=>a.attribute==="GENERAL")}}),F=h({}),c=h({name:"",id:"",outside:0,ship:0,address:""}),G=S(()=>{var o;return(o=F.value)==null?void 0:o.deliveryFee});let A=null;Te(async()=>{if(de(),await xe(),U.value<=0)return le.push({path:"/"});await L(),A=setInterval(()=>{ce()},1e3)}),Ce(()=>{clearInterval(A),A=null});async function L(){try{const a=Z(),o=await $fetch(`${$.public.apiBase}/${Oe}`,{method:"POST",body:a,headers:{authorization:"Bearer "+localStorage.getItem("accessToken")}});console.log("pre-settlement, ",o),F.value=o.data}catch{}}function ce(){c.value.name=localStorage.getItem("storename"),c.value.id=localStorage.getItem("storeid"),c.value.address=localStorage.getItem("storeaddress"),c.value.ship=localStorage.getItem("ship"),c.value.outside=localStorage.getItem("outside")}function de(){switch(re.query.type){case"cold-chain":T.value=N.ColdChain;break;default:T.value=N.General;break}}const H=a=>{var o,d;return((o=l==null?void 0:l.user)==null?void 0:o.memberLevel)==="SVIP"?a==null?void 0:a.svipPrice:((d=l==null?void 0:l.user)==null?void 0:d.memberLevel)==="VIP"?a==null?void 0:a.vipPrice:l.status.loggedIn?a==null?void 0:a.memberPrice:a==null?void 0:a.price},n=h({attribute:T.value,choosePayment:D.CreditOneTime,consignee:{deliveryType:b.Home,city:"",email:(j=l.user)==null?void 0:j.email,idNo:"",idType:"1",cellphone:(K=l.user)==null?void 0:K.cellphone,name:(Y=l.user)==null?void 0:Y.nickname,remark:"",senderRemark:"",stationCode:"",stationName:"",addressDetailOne:(J=l.user)==null?void 0:J.addressOne,province:"",district:"",town:"",zipCode:""},invoiceParams:{customerName:(Q=l.user)==null?void 0:Q.nickname,customerEmail:(W=l.user)==null?void 0:W.email,customerPhone:(X=l.user)==null?void 0:X.cellphone,customerAddr:(ee=l.user)==null?void 0:ee.addressOne,customerIdentifier:"",carruerType:R.Member,carruerNum:"",donation:"0",loveCode:""},products:[],bonusPointRedemption:0});function Z(){var o,d;return{...n.value,attribute:T.value,consignee:{...n.value.consignee,stationCode:n.value.consignee.deliveryType===b.Store?(o=c.value)==null?void 0:o.id:"",stationName:n.value.consignee.deliveryType===b.Store?(d=c.value)==null?void 0:d.name:""},invoiceParams:{...n.value.invoiceParams,carruerType:P.value?n.value.invoiceParams.carruerNum:"",carruerNum:n.value.invoiceParams.carruerType>=2?n.value.invoiceParams.carruerNum:"",donation:m.value?1:0,loveCode:m.value?n.value.invoiceParams.loveCode:"",customerIdentifier:ie.value?n.value.invoiceParams.customerIdentifier:"00000000",customerPhone:n.value.consignee.cellphone,customerName:n.value.consignee.name,customerAddr:n.value.consignee.addressDetailOne},bonusPointRedemption:k.value,products:U.value.map(y=>({id:y.id,quantity:y.amount}))}}async function ue(){if(!pe())return;const o=Z();console.log(o);try{const d=`${$.public.baseUrl}/order?payment=successful`,y=await $fetch(`${$.public.apiBase}/${Se}?order_result_url=${d}`,{method:"POST",body:o,headers:{authorization:"Bearer "+localStorage.getItem("accessToken")}});f.loading("\u5373\u5C07\u5C0E\u5411\u4ED8\u6B3E\u9801\u9762\uFF0C\u8ACB\u7A0D\u5019...");const V=document.createElement("credit-div");V.innerHTML=y,V.id="credit-payment",document.body.appendChild(V),document.getElementById("_form_aiochk").submit(),console.log(y)}catch(d){f.error(d.data)}}function pe(){if(!n.value.consignee.name||!n.value.consignee.cellphone||!n.value.consignee.addressDetailOne)return f.error("\u8ACB\u78BA\u5BE6\u586B\u5BEB\u6536\u4EF6\u4EBA\u8CC7\u8A0A"),!1;if(n.value.consignee.deliveryType===b.Store&&(!c.value.id||!c.value.name))return f.error("\u8ACB\u9078\u64C7\u6B32\u53D6\u8CA8\u7684\u5E97\u5BB6"),!1;if(m.value){const a=/^\d{3,7}$/,o=n.value.invoiceParams.loveCode;if(!a.test(o)){f.error("\u611B\u5FC3\u78BC\u8ACB\u8F38\u51653-7\u78BC\u7684\u6578\u5B57\u7D44\u5408");return}}if(P.value){let a,o;n.value.invoiceParams.carruerType===2&&(a=/^[a-zA-Z]{2}[0-9]{14}$/,o="16\u78BC\u7684\u82F1\u6578\u7D44\u5408"),n.value.invoiceParams.carruerType===3&&(a=/^\/{1}[0-9A-Z]{7}$/,o="8\u78BC\u7684\u82F1\u6578\u7D44\u5408");const d=n.value.invoiceParams.carruerNum;if(n.value.invoiceParams.carruerType>=2&&!a.test(d)){f.error(`\u8ACB\u8F38\u5165\u7B26\u5408\u683C\u5F0F\u7684\u8F09\u5177\u8CC7\u6599(${o})`);return}}return O.value?!0:(f.error("\u8ACB\u8A73\u95B1\u76F8\u95DC\u8CFC\u8CB7\u689D\u6B3E\u4E26\u52FE\u9078\u78BA\u8A8D"),!1)}function me(){const a=`${$.public.baseUrl}`;window.open(`https://emap.presco.com.tw/c2cemap.ashx?eshopid=870&&servicetype=1&url=${a}/cvs_callback`)}function ve(a){return a<Date.now()}return(a,o)=>{const d=ae("n-input-number"),y=ae("n-date-picker"),V=he,_e=Pe;return C(),x("div",qe,[e("form",De,[e("table",Re,[e("tbody",null,[(C(!0),x(Ue,null,Ve(t(U),s=>{var oe,te;return C(),x("tr",{key:s.id,class:"prod-tr"},[e("td",Me,[e("img",{src:s==null?void 0:s.coverImg},null,8,Ae)]),e("td",Le,[e("h5",null,_(s==null?void 0:s.name),1),e("div",Be," x"+_(s==null?void 0:s.amount),1)]),e("td",Ee,[r(e("span",null,"\u5E02\u50F9 $"+_(s==null?void 0:s.price),513),[[B,((oe=t(l).user)==null?void 0:oe.memberLevel)&&((te=t(l).user)==null?void 0:te.memberLevel)!=="NORMAL"]]),i(" \u50F9\u9322 $"+_(H(s)),1)])])}),128))])]),e("div",ze,[Fe,e("div",Ge,[e("label",He,[r(e("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>t(n).consignee.deliveryType=s),type:"radio",name:"shipping",value:t(b).Home,onClick:L},null,8,Ze),[[v,t(n).consignee.deliveryType]]),i(" \u5B85\u914D\u5230\u5E9C ")]),r(e("label",je,[r(e("input",{"onUpdate:modelValue":o[1]||(o[1]=s=>t(n).consignee.deliveryType=s),type:"radio",name:"shipping",value:t(b).Store,onClick:L},null,8,Ke),[[v,t(n).consignee.deliveryType]]),i(" \u8D85\u5546\u53D6\u8CA8 ")],512),[[B,t(T)===t(N).General]])])]),e("div",Ye,[Je,e("div",Qe,[e("label",We,[r(e("input",{"onUpdate:modelValue":o[2]||(o[2]=s=>t(n).choosePayment=s),type:"radio",name:"payment",value:t(D).CreditOneTime},null,8,Xe),[[v,t(n).choosePayment]]),i(" \u4FE1\u7528\u5361 ")]),e("label",eo,[r(e("input",{"onUpdate:modelValue":o[3]||(o[3]=s=>t(n).choosePayment=s),type:"radio",name:"payment",value:t(D).BarCode},null,8,oo),[[v,t(n).choosePayment]]),i(" \u8D85\u5546\u689D\u78BC\u4ED8\u6B3E ")]),e("label",to,[r(e("input",{"onUpdate:modelValue":o[4]||(o[4]=s=>t(n).choosePayment=s),type:"radio",value:t(D).Cvs,name:"payment"},null,8,so),[[v,t(n).choosePayment]]),i(" \u8D85\u5546\u4EE3\u78BC\u4ED8\u6B3E ")])])]),e("div",no,[e("h5",null,"\u7D05\u5229\u6263\u9EDE (\u76EE\u524D\u53EF\u7528\u7D05\u5229\uFF1A"+_(t(z))+" \u9EDE)",1),e("div",ao,[q(d,{value:t(k),"onUpdate:value":o[5]||(o[5]=s=>I(k)?k.value=s:null),min:"0",max:t(z),style:{width:"150px",margin:"4px 0 4px 15px"}},null,8,["value","max"])])]),e("div",ro,[lo,e("div",io,[r(e("input",{id:"ship_name2","onUpdate:modelValue":o[6]||(o[6]=s=>t(n).consignee.name=s),type:"text",placeholder:"\u59D3\u540D*",class:"form-control",name:"",required:""},null,512),[[u,t(n).consignee.name]]),r(e("input",{id:"ship_phone2","onUpdate:modelValue":o[7]||(o[7]=s=>t(n).consignee.cellphone=s),type:"text",placeholder:"\u624B\u6A5F*",class:"form-control",name:"",required:""},null,512),[[u,t(n).consignee.cellphone]]),r(e("input",{id:"ship_address","onUpdate:modelValue":o[8]||(o[8]=s=>t(n).consignee.province=s),type:"text",placeholder:"\u7701*",class:"form-control",name:"",required:""},null,512),[[u,t(n).consignee.province]]),r(e("input",{id:"ship_address","onUpdate:modelValue":o[9]||(o[9]=s=>t(n).consignee.district=s),type:"text",placeholder:"\u884C\u653F\u5340*",class:"form-control",name:"",required:""},null,512),[[u,t(n).consignee.district]]),r(e("input",{id:"ship_address","onUpdate:modelValue":o[10]||(o[10]=s=>t(n).consignee.city=s),type:"text",placeholder:"\u57CE\u5E02*",class:"form-control",name:"",required:""},null,512),[[u,t(n).consignee.city]]),r(e("input",{id:"ship_address","onUpdate:modelValue":o[11]||(o[11]=s=>t(n).consignee.zipCode=s),type:"text",placeholder:"\u90F5\u905E\u5340\u865F*",class:"form-control",name:"",required:""},null,512),[[u,t(n).consignee.zipCode]]),r(e("input",{id:"ship_address","onUpdate:modelValue":o[12]||(o[12]=s=>t(n).consignee.addressDetailOne=s),type:"text",placeholder:"\u6536\u4EF6\u5730\u5740*",class:"form-control",name:"",required:""},null,512),[[u,t(n).consignee.addressDetailOne]]),q(V,null,{default:se(()=>[q(y,{type:"date",placeholder:"\u8ACB\u9078\u64C7\u53EF\u6536\u8CA8\u65E5\u671F","is-date-disabled":ve,required:""})]),_:1})])]),r(e("div",co,[uo,e("div",{class:"emap"},[e("button",{onClick:me}," \u9078\u64C7\u5E97\u8216 ")]),e("div",po,[r(e("input",{id:"store-name","onUpdate:modelValue":o[13]||(o[13]=s=>t(c).name=s),type:"text",required:"",class:"form-control bold",disabled:""},null,512),[[u,t(c).name]])]),e("div",mo,[r(e("input",{id:"store-address","onUpdate:modelValue":o[14]||(o[14]=s=>t(c).address=s),type:"text",required:"",class:"form-control bold",disabled:""},null,512),[[u,t(c).address]])])],512),[[B,t(n).consignee.deliveryType===t(b).Store]]),e("div",vo,[_o,e("div",ho,[e("label",fo,[r(e("input",{"onUpdate:modelValue":o[15]||(o[15]=s=>I(m)?m.value=s:null),type:"radio",name:"donation",value:!1},null,512),[[v,t(m)]]),i(" \u958B\u7ACB\u767C\u7968 ")]),e("label",yo,[r(e("input",{"onUpdate:modelValue":o[16]||(o[16]=s=>I(m)?m.value=s:null),type:"radio",name:"donation",value:!0},null,512),[[v,t(m)]]),i(" \u6350\u8D08\u767C\u7968 ")])])]),t(m)?(C(),x("div",bo,[go,e("div",ko,[e("div",Po,[r(e("input",{id:"inv_ship_lovecode","onUpdate:modelValue":o[17]||(o[17]=s=>t(n).invoiceParams.loveCode=s),type:"text",placeholder:"\u8ACB\u8F38\u5165\u6350\u8D08\u611B\u5FC3\u78BC*",class:"form-control",name:"",required:""},null,512),[[u,t(n).invoiceParams.loveCode]])])])])):E("",!0),e("div",To,[xo,e("div",Co,[e("label",Uo,[r(e("input",{id:"change-image","onUpdate:modelValue":o[18]||(o[18]=s=>I(P)?P.value=s:null),type:"checkbox"},null,512),[[ne,t(P)]]),i(" \u4F7F\u7528\u8F09\u5177 ")]),t(P)?(C(),x("div",Vo,[e("label",Io,[r(e("input",{"onUpdate:modelValue":o[19]||(o[19]=s=>t(n).invoiceParams.carruerType=s),type:"radio",name:"uic-member",value:t(R).Member},null,8,No),[[v,t(n).invoiceParams.carruerType]]),i(" \u6703\u54E1\u8F09\u5177 ")]),e("label",wo,[r(e("input",{"onUpdate:modelValue":o[20]||(o[20]=s=>t(n).invoiceParams.carruerType=s),type:"radio",name:"uic-npc",value:t(R).NPC},null,8,$o),[[v,t(n).invoiceParams.carruerType]]),i(" \u81EA\u7136\u4EBA\u6191\u8B49 ")]),e("label",Oo,[r(e("input",{"onUpdate:modelValue":o[21]||(o[21]=s=>t(n).invoiceParams.carruerType=s),type:"radio",name:"uic-mobile",value:t(R).Mobile},null,8,So),[[v,t(n).invoiceParams.carruerType]]),i(" \u624B\u6A5F\u689D\u78BC ")]),t(n).invoiceParams.carruerType>=2?r((C(),x("input",{key:0,id:"inv-carruerNum","onUpdate:modelValue":o[22]||(o[22]=s=>t(n).invoiceParams.carruerNum=s),type:"text",placeholder:"\u8ACB\u8F38\u5165\u5C0D\u61C9\u7684\u8F09\u5177\u7DE8\u865F",class:"form-control",required:"",name:""},null,512)),[[u,t(n).invoiceParams.carruerNum]]):E("",!0)])):E("",!0)])]),e("div",qo,[Do,r(e("textarea",{id:"","onUpdate:modelValue":o[23]||(o[23]=s=>t(n).consignee.remark=s),rows:"6",placeholder:"\u8ACB\u8F38\u5165\u8A02\u55AE\u5099\u8A3B\u5167\u5BB9",class:"form-control",name:""},null,512),[[u,t(n).consignee.remark]])]),e("div",Ro,[Mo,e("ul",Ao,[e("li",null," \u5546\u54C1\u91D1\u984D\u5C0F\u8A08 (\u5171"+_(t(U).length)+"\u9805\u5546\u54C1)\uFF1A$"+_(t(M)),1),e("li",null," \u904B\u8CBB\uFF1A"+_(t(G)),1),e("li",null," \u7D05\u5229\u6263\u9EDE\uFF1A"+_(t(k)),1),e("li",Lo,[i(" \u8A02\u55AE\u7E3D\u91D1\u984D\uFF1A"),e("span",null,"$"+_(t(M)-t(k)+t(G)),1)])])]),e("div",Bo,[e("label",Eo,[r(e("input",{id:"check_service","onUpdate:modelValue":o[24]||(o[24]=s=>I(O)?O.value=s:null),type:"checkbox",required:""},null,512),[[ne,t(O)]]),i(" \u6211\u5DF2\u7D93\u95B1\u8B80\u4E26\u540C\u610F\u4EE5\u4E0A\u8CFC\u8CB7\u9808\u77E5\u3001 "),zo,i("\u8207"),Fo,i("\uFF0C\u6B64\u6B04\u4F4D\u52FE\u9078\u624D\u53EF\u9001\u51FA\u3002 ")])]),Go,e("div",Ho,[q(_e,{type:"button",class:"btn btn-main btn-default",to:"/cart"},{default:se(()=>[i(" \u4E0A\u4E00\u9801 ")]),_:1}),e("input",{id:"",type:"submit",class:"btn btn-main btn-check check_service_btn submit_home",value:"\u78BA\u8A8D\u9001\u51FA",onClick:ue})])])])}}},et=fe(Zo,[["__scopeId","data-v-eb71ab04"]]);export{et as default};
