import{H as x,r as B,b as C,q as G,u as L,B as h,Q as S,O,C as E}from"./entry.bfd5dcdb.js";import{_ as R}from"./client-only.46688fa6.js";import{b as q,o as I,a3 as N,a0 as m,Z as P,aa as o,C as n,J as b,af as y,y as l,$ as U}from"./swiper-vue.6d0a2b42.js";const V={class:"full_height mt185ptb30"},z={class:"container"},A=o("h3",{class:"login_tl"},[n(" \u6703\u54E1\u767B\u5165"),o("br"),n("Login ")],-1),M=o("i",{class:"fa-brands fa-google-plus-g"},null,-1),F={class:"contact-form"},j={id:"",method:"post",action:"javascript:;"},D={class:"form-group"},H={class:"form-group"},J={class:"other_function"},X={__name:"login",setup(Q){const p=x(),g=B(),a=C(),c=G(),i=L(),r=q({email:"",password:""});I(async()=>{const e=localStorage.getItem("accessToken"),t=localStorage.getItem("refreshToken");if(e){try{const s=await $fetch(`${i.public.apiBase}/${h}`,{method:"GET",headers:{Authorization:"Bearer "+e}});c.loginSuccess(e,t),c.updateUser(s.data),a.success("\u5DF2\u81EA\u52D5\u767B\u5165")}catch{c.logout(),a.error("\u767B\u5165\u5DF2\u903E\u671F\uFF0C\u8ACB\u91CD\u65B0\u767B\u5165");return}f()}k()});function T(){!google||google.accounts.id.prompt()}function k(){!google||google.accounts.id.initialize({client_id:i.public.googleClientId,callback:v})}async function v(e){try{const t=await $fetch(`${i.public.apiBase}/${S}`,{method:"POST",body:{accessToken:e==null?void 0:e.credential}});_(t.data),a.success("\u767B\u5165\u6210\u529F")}catch(t){t.statusCode&&a.error("\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u5E33\u865F\u53CA\u5BC6\u78BC")}}async function w(){try{const e=await $fetch(`${i.public.apiBase}/${O}`,{method:"POST",body:r.value});_(e.data),a.success("\u767B\u5165\u6210\u529F")}catch(e){e.statusCode&&a.error("\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u5E33\u865F\u53CA\u5BC6\u78BC")}}async function _(e){const{accessToken:t,refreshToken:s}=e;c.loginSuccess(t,s);const u=await $fetch(`${i.public.apiBase}/${h}`,{method:"GET",headers:{Authorization:"Bearer "+t}});c.updateUser(u.data),f()}function f(){var t;const e=(t=p.query)==null?void 0:t.redirect;if(e){const s={...p.query};delete s.redirect,g.push({path:e,query:s})}else g.push({path:"/profile"})}function $(){window.scrollTo({top:0,behavior:"smooth"})}return(e,t)=>{const s=E,u=R;return P(),N(u,null,{default:m(()=>[o("section",V,[o("div",z,[A,o("div",{class:"social_login"},[n(" \u4F7F\u7528\uFF1A "),o("button",{id:"google-login",class:"btn btn-check bg-google",style:{margin:"4px"},onClick:T},[M,n(" Google\u5E33\u865F\u767B\u5165 ")])]),o("div",F,[o("form",j,[o("div",D,[b(o("input",{id:"input-field-email","onUpdate:modelValue":t[0]||(t[0]=d=>l(r).email=d),type:"email",placeholder:"Email*",class:"form-control",name:"",required:""},null,512),[[y,l(r).email]])]),o("div",H,[b(o("input",{id:"input-field-password","onUpdate:modelValue":t[1]||(t[1]=d=>l(r).password=d),autocomplete:"",type:"password",placeholder:"\u5BC6\u78BC*",class:"form-control",name:"",required:""},null,512),[[y,l(r).password]])]),o("div",{class:"text-center"},[o("input",{id:"input-field-submit",type:"submit",class:"btn btn-main btn-bag",value:"\u6211\u8981\u767B\u5165",onClick:w})])]),o("div",J,[n(" \u6C92\u6709\u5E33\u865F? "),o("div",{onClick:$},[U(s,{class:"btn btn-block btn-bag",to:"/register"},{default:m(()=>[n(" \u6703\u54E1\u8A3B\u518A ")]),_:1})])])])])])]),_:1})}}};export{X as default};
