import{a as D,b as M,r as w,q as P,u as L,y as U,z as A,B as N,C as R,E as V}from"./entry.809284d4.js";import{u as z}from"./pageStatusStore.3ec6dd8c.js";import{b as G,c as b,o as q,_,aa as o,$ as F,a0 as O,C as d,ae as l,y as c,F as Y,V as H,Z as p,ad as C,a8 as Q,a9 as j}from"./swiper-vue.6d0a2b42.js";const h=i=>(Q("data-v-8713f8b7"),i=i(),j(),i),K={class:"full_height mt185ptb30 bg_left2"},Z={class:"container signpoint_content"},y={class:"text-center mypoint"},J=h(()=>o("i",{class:"fas fa-parking"},null,-1)),W={class:"text-center"},X={id:"signpoint"},ee=h(()=>o("div",{class:"mb-20"},null,-1)),se={class:"signpoint_li"},te=["onClick"],oe={class:"t1"},ae={href:"javascript:;"},ne={class:"t2 sign_day"},ce=h(()=>o("div",{class:"mt-20"},null,-1)),ie={__name:"bonus-point",setup(i){const f=M(),v=w(),n=P(),g=z(),r=L(),u=G([]),m=b(()=>u.value.reduce((e,t)=>e+(t!=null&&t.accepted?1:0),0)),S=b(()=>m.value),E=e=>e!=null&&e.accepted?e!=null&&e.isMission?"\u4EFB\u52D9\u5DF2\u89E3\u9396":"\u5DF2\u7C3D\u5230":e!=null&&e.isMission?"\u4EFB\u52D9\u89E3\u9396":"\u7C3D\u5230";q(()=>{n.status.loggedIn||v.push({path:"/login",query:{redirect:"/bonus-point"}}),k()});async function k(){try{const e=await $fetch(`${r.public.apiBase}/${U}`),t=await $fetch(`${r.public.apiBase}/${A}`,{headers:{authorization:"Bearer "+localStorage.getItem("accessToken")}}),a=e.data.map(s=>{const x=t.data.find(B=>B.index===s.index);return{...s,accepted:!!x}});u.value=a}catch(e){console.log(e)}T()}async function T(){try{const e=localStorage.getItem("accessToken"),t=localStorage.getItem("refreshToken"),a=await $fetch(`${r.public.apiBase}/${N}`,{method:"GET",headers:{Authorization:"Bearer "+e}});n.loginSuccess(e,t),n.updateUser(a.data)}catch{n.logout()}}async function $(e){e.accepted||(e.isMission&&(g.setDailyVideoURL(e.video),g.toggleVideoDialog(!0),await new Promise(t=>{setTimeout(()=>t(),5e3)})),I(e))}async function I(e){var t,a;try{await $fetch(`${r.public.apiBase}/${V(e.index)}`,{method:"POST",headers:{authorization:"Bearer "+localStorage.getItem("accessToken")}}),f.success(`\u7C3D\u5230\u6210\u529F \u7D05\u5229 +${e.credit}`,{duration:2e3})}catch(s){f.error(((a=(t=s==null?void 0:s.data)==null?void 0:t.data)==null?void 0:a.message)==="User already checked in today."?"\u4ECA\u65E5\u5DF2\u7C3D\u5230":"\u7C3D\u5230\u5931\u6557")}k()}return(e,t)=>{const a=R;return p(),_("section",K,[o("div",Z,[o("h4",y,[F(a,{to:"/bonus-point"},{default:O(()=>{var s;return[d(" \u6211\u7684\u7D05\u5229 "),J,d(" "+l((s=c(n).user)==null?void 0:s.rewardCredit),1)]}),_:1})]),o("div",W,[d(" \u5DF2\u7D2F\u8A08\u7C3D\u5230\uFF1A"+l(c(m))+"\u6B21 ",1),o("div",X,[ee,o("ul",se,[(p(!0),_(Y,null,H(c(u),s=>(p(),_("li",{key:s.index,class:C(["day-slot",{sign:s.accepted,"no-cursor":s.accepted||s.index!==c(S),inactive:s.index>c(S),mission:s.isMission,"mission-accepted":s.accepted&&s.isMission}]),onClick:x=>$(s)},[o("span",oe,"+"+l(s.credit),1),o("a",ae,[o("i",{class:C(["fa-solid",{"fa-p":!s.isMission,"fa-lock":s.isMission,"fa-unlock":s.accepted&&s.isMission}])},null,2)]),o("span",ne,l(E(s)),1)],10,te))),128))]),ce])])])])}}},_e=D(ie,[["__scopeId","data-v-8713f8b7"]]);export{_e as default};
