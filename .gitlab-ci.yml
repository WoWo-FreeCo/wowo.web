image: node:16.13.2

cache:
  paths:
    - node_modules/
    - client/node_modules/
    - server/node_modules/

stages:
  # - build
  - deploy

develop-build:
  stage: build
  only:
    - develop
  script:
    - echo "build for develop"
    - npm install
    - npm run build
    - echo 'build completed'

develop-deploy:
  stage: deploy
  only:
    - develop
  script:
    - echo "deploy to develop server"
    - ssh root@172.104.104.171
    - ${SSH_PASSWORD}
    - cd var/www/wowo.web && git pull
    - git pull
    - ${GIT_USERNAME}
    - ${GIT_PASSWORD}
    - pm2 restart index
    - echo 'deploy completed'