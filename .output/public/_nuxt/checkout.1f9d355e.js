import{_ as fe}from"./client-only.73480984.js";import{a as ye,j as be,e as ge,b as ke,u as Pe,k as xe}from"./entry.96dc2463.js";import{b as h,c as $,o as Ce,q as Te,P as Ue,_ as y,aa as e,F as Ve,V as Ie,y as o,J as l,ah as m,C as i,G as B,ae as _,$ as R,i as x,af as d,a0 as ae,ai as F,ab as le,f as re,Z as b,a8 as Ne,a9 as we}from"./swiper-vue.d582d122.js";import{u as qe}from"./authStore.126ed91f.js";import{u as Oe}from"./cartStore.391fa2af.js";import{r as Se,s as $e}from"./requestURL.6ae00f75.js";import{P as N,a as D,D as C,U as M}from"./common.0260327a.js";const c=w=>(Ne("data-v-51e0148f"),w=w(),we(),w),Re={class:"full_height mt185ptb30"},De={id:"checkout_form",action:"javascript:;",class:"cart_container"},Me={class:"cart_list"},Ee={class:"cart_img"},Le=["src"],Ae={class:"cart_tl"},Be={class:"product-quantity"},Fe=c(()=>e("span",null,"\u6EFF\u4EF6\u514D\u904B",-1)),Ge={class:"cart_price text-right"},He={class:"cart_info"},ze=c(()=>e("h5",null,"\u5BC4\u9001\u65B9\u5F0F",-1)),je={class:"checkout-form"},Ke={class:"radio form-check"},Ye=["value"],Je={class:"radio form-check"},Ze=["value"],Qe={class:"cart_info"},We=c(()=>e("h5",null,"\u4ED8\u6B3E\u65B9\u5F0F",-1)),Xe={class:"checkout-form"},eo={class:"radio form-check"},oo=["value"],to={class:"radio form-check"},so=["value"],no={class:"radio form-check"},ao=["value"],lo={class:"cart_info"},ro={class:"checkout-form"},io={id:"ship_home_form",class:"cart_info"},co=c(()=>e("h5",null,"\u6536\u4EF6\u4EBA\u8CC7\u8A0A",-1)),uo={class:"ship_info"},po={class:"cart_info checkout-form"},mo=c(()=>e("h5",null,"\u8D85\u5546\u53D6\u8CA8\u8CC7\u8A0A",-1)),_o={class:"store-name"},vo={class:"store-address"},ho={class:"cart_info"},fo=c(()=>e("h5",null,"\u8ACB\u9078\u64C7\u767C\u7968\u9078\u9805",-1)),yo={class:"checkout-form"},bo={class:"radio form-check"},go={class:"radio form-check"},ko={class:"cart_info checkout-form"},Po=c(()=>e("h5",null,"\u767C\u7968\u8CC7\u8A0A",-1)),xo={key:0,class:"ship_info inv-info"},Co={class:"ship_info"},To={class:"checkbox pt10 pb10"},Uo={key:0,class:"ship_info"},Vo={key:1,class:"ship_info inv-info"},Io={class:"ship_info"},No={class:"cart_info checkout-form"},wo=c(()=>e("h5",null,"\u8F09\u5177\u8CC7\u8A0A",-1)),qo={class:"ship_info inv-info"},Oo={class:"checkbox pt10 pb10"},So={key:0,class:"ship_info"},$o={class:"radio form-check"},Ro=["value"],Do={class:"radio form-check"},Mo=["value"],Eo={class:"radio form-check"},Lo=["value"],Ao={class:"cart_info checkout-form"},Bo=c(()=>e("h5",null,"\u8A02\u55AE\u5099\u8A3B",-1)),Fo={class:"cart_info"},Go=c(()=>e("h5",null,"\u4ED8\u6B3E\u660E\u7D30",-1)),Ho={class:"cart_check"},zo={class:"border_top"},jo={class:"cart_info checkout-form ptb10"},Ko={class:"checkbox"},Yo=c(()=>e("a",{href:"/terms",target:"new"},"\u6703\u54E1\u4F7F\u7528\u689D\u6B3E",-1)),Jo=c(()=>e("a",{href:"/privacy",target:"new"},"\u96B1\u79C1\u6B0A\u653F\u7B56",-1)),Zo=c(()=>e("div",{class:"text-center mb-20 mt-20"},[e("span",{id:"errormsg"})],-1)),Qo={class:"text-center mb-20 mt-20"},Wo={__name:"checkout",setup(w){var Y,J,Z,Q,W,X,ee,oe;const ie=be(),ce=ge(),q=ke(),O=Pe(),r=qe(),g=Oe(),k=h(0),T=h(!1),U=h(!1),S=h(!1),v=h(!1),P=h(N.General),E=$({get:()=>V.value.reduce((a,t)=>a+j(t)*t.amount,0),set:a=>{E.value=a}}),G=$(()=>{var a;return((a=r==null?void 0:r.user)==null?void 0:a.rewardCredit)||0}),V=$(()=>{switch(P.value){case N.ColdChain:return g==null?void 0:g.merch.filter(a=>a.attribute==="COLD_CHAIN");default:return g==null?void 0:g.merch.filter(a=>a.attribute==="GENERAL")}}),H=h({}),u=h({name:"",id:"",outside:0,ship:0,address:""}),z=$(()=>{var t;return(t=H.value)==null?void 0:t.deliveryFee});let L=null;Ce(async()=>{if(ue(),await Te(),V.value<=0)return ce.push({path:"/"});await A(),L=setInterval(()=>{de()},1e3)}),Ue(()=>{clearInterval(L),L=null});async function A(){try{const a=K(),t=await $fetch(`${O.public.apiBase}/${Se}`,{method:"POST",body:a,headers:{authorization:"Bearer "+localStorage.getItem("accessToken")}});console.log("pre-settlement, ",t),H.value=t.data}catch{}}function de(){u.value.name=localStorage.getItem("storename"),u.value.id=localStorage.getItem("storeid"),u.value.address=localStorage.getItem("storeaddress"),u.value.ship=localStorage.getItem("ship"),u.value.outside=localStorage.getItem("outside")}function ue(){switch(ie.query.type){case"cold-chain":P.value=N.ColdChain;break;default:P.value=N.General;break}}const j=a=>{var t,p;return((t=r==null?void 0:r.user)==null?void 0:t.memberLevel)==="SVIP"?a==null?void 0:a.svipPrice:((p=r==null?void 0:r.user)==null?void 0:p.memberLevel)==="VIP"?a==null?void 0:a.vipPrice:r.status.loggedIn?a==null?void 0:a.memberPrice:a==null?void 0:a.price},n=h({attribute:P.value,choosePayment:D.CreditOneTime,consignee:{deliveryType:C.Home,addressDetailOne:(Y=r.user)==null?void 0:Y.addressOne,city:"",district:"",email:(J=r.user)==null?void 0:J.email,idNo:"",idType:"1",cellphone:(Z=r.user)==null?void 0:Z.cellphone,name:(Q=r.user)==null?void 0:Q.nickname,province:"",remark:"",senderRemark:"",stationCode:"",stationName:"",town:"",zipCode:""},invoiceParams:{customerName:(W=r.user)==null?void 0:W.nickname,customerEmail:(X=r.user)==null?void 0:X.email,customerPhone:(ee=r.user)==null?void 0:ee.cellphone,customerAddr:(oe=r.user)==null?void 0:oe.addressOne,customerIdentifier:"",carruerType:M.Member,carruerNum:"",donation:"0",loveCode:""},products:[],bonusPointRedemption:0});function K(){var t,p;return{...n.value,attribute:P.value,consignee:{...n.value.consignee,stationCode:n.value.consignee.deliveryType===C.Store?(t=u.value)==null?void 0:t.id:"",stationName:n.value.consignee.deliveryType===C.Store?(p=u.value)==null?void 0:p.name:""},invoiceParams:{...n.value.invoiceParams,carruerType:U.value?n.value.invoiceParams.carruerNum:"",carruerNum:n.value.invoiceParams.carruerNum,donation:v.value?1:0,loveCode:v.value?n.value.invoiceParams.loveCode:"",customerIdentifier:T.value?n.value.invoiceParams.customerIdentifier:"00000000"},bonusPointRedemption:k.value,products:V.value.map(f=>({id:f.id,quantity:f.amount}))}}async function pe(){if(!me())return;const t=K();console.log(t);try{const p=`${O.public.baseUrl}/order?payment=successful`,f=await $fetch(`${O.public.apiBase}/${$e}?order_result_url=${p}`,{method:"POST",body:t,headers:{authorization:"Bearer "+localStorage.getItem("accessToken")}});q.loading("\u5373\u5C07\u5C0E\u5411\u4ED8\u6B3E\u9801\u9762\uFF0C\u8ACB\u7A0D\u5019...");const I=document.createElement("credit-div");I.innerHTML=f,I.id="credit-payment",document.body.appendChild(I),document.getElementById("_form_aiochk").submit(),console.log(f)}catch(p){q.error(p.data)}}function me(){return!n.value.consignee.name||!n.value.consignee.cellphone||!n.value.consignee.addressDetailOne?(q.error("\u8ACB\u78BA\u5BE6\u586B\u5BEB\u6536\u4EF6\u4EBA\u8CC7\u8A0A"),!1):S.value?!0:(q.error("\u8ACB\u8A73\u95B1\u76F8\u95DC\u8CFC\u8CB7\u689D\u6B3E\u4E26\u52FE\u9078\u78BA\u8A8D"),!1)}function _e(){const a=`${O.public.baseUrl}`;window.open(`https://emap.presco.com.tw/c2cemap.ashx?eshopid=870&&servicetype=1&url=${a}/cvs_callback`)}function ve(a){return a<Date.now()}return(a,t)=>{const p=re("n-input-number"),f=re("n-date-picker"),I=fe,he=xe;return b(),y("div",Re,[e("form",De,[e("table",Me,[e("tbody",null,[(b(!0),y(Ve,null,Ie(o(V),s=>{var te,se,ne;return b(),y("tr",{key:s.id,class:"prod-tr"},[e("td",Ee,[e("img",{src:((te=s==null?void 0:s.thumbnail)==null?void 0:te.url)||`https://picsum.photos/500/500?${s.id}`},null,8,Le)]),e("td",Ae,[e("h5",null,_(s==null?void 0:s.name),1),e("div",Be," x"+_(s==null?void 0:s.amount),1),Fe]),e("td",Ge,[l(e("span",null,"\u5E02\u50F9 $"+_(s==null?void 0:s.price),513),[[B,((se=o(r).user)==null?void 0:se.memberLevel)&&((ne=o(r).user)==null?void 0:ne.memberLevel)!=="NORMAL"]]),i(" \u50F9\u9322 $"+_(j(s)),1)])])}),128))])]),e("div",He,[ze,e("div",je,[e("label",Ke,[l(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>o(n).consignee.deliveryType=s),type:"radio",name:"shipping",value:o(C).Home,onClick:A},null,8,Ye),[[m,o(n).consignee.deliveryType]]),i(" \u5B85\u914D\u5230\u5E9C ")]),l(e("label",Je,[l(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>o(n).consignee.deliveryType=s),type:"radio",name:"shipping",value:o(C).Store,onClick:A},null,8,Ze),[[m,o(n).consignee.deliveryType]]),i(" \u8D85\u5546\u53D6\u8CA8 ")],512),[[B,o(P)===o(N).General]])])]),e("div",Qe,[We,e("div",Xe,[e("label",eo,[l(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>o(n).choosePayment=s),type:"radio",name:"payment",value:o(D).CreditOneTime},null,8,oo),[[m,o(n).choosePayment]]),i(" \u4FE1\u7528\u5361 ")]),e("label",to,[l(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o(n).choosePayment=s),type:"radio",name:"payment",value:o(D).BarCode},null,8,so),[[m,o(n).choosePayment]]),i(" \u8D85\u5546\u689D\u78BC\u4ED8\u6B3E ")]),e("label",no,[l(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o(n).choosePayment=s),type:"radio",value:o(D).Cvs,name:"payment"},null,8,ao),[[m,o(n).choosePayment]]),i(" \u8D85\u5546\u4EE3\u78BC\u4ED8\u6B3E ")])])]),e("div",lo,[e("h5",null,"\u7D05\u5229\u6263\u9EDE (\u76EE\u524D\u53EF\u7528\u7D05\u5229\uFF1A"+_(o(G))+" \u9EDE)",1),e("div",ro,[R(p,{value:o(k),"onUpdate:value":t[5]||(t[5]=s=>x(k)?k.value=s:null),min:"0",max:o(G),style:{width:"150px",margin:"4px 0 4px 15px"}},null,8,["value","max"])])]),e("div",io,[co,e("div",uo,[l(e("input",{id:"ship_name2","onUpdate:modelValue":t[6]||(t[6]=s=>o(n).consignee.name=s),type:"text",placeholder:"\u59D3\u540D*",class:"form-control",name:"",required:""},null,512),[[d,o(n).consignee.name]]),l(e("input",{id:"ship_phone2","onUpdate:modelValue":t[7]||(t[7]=s=>o(n).consignee.cellphone=s),type:"text",placeholder:"\u624B\u6A5F*",class:"form-control",name:"",required:""},null,512),[[d,o(n).consignee.cellphone]]),l(e("input",{id:"ship_address","onUpdate:modelValue":t[8]||(t[8]=s=>o(n).consignee.addressDetailOne=s),type:"text",placeholder:"\u5730\u5740*",class:"form-control",name:"",required:""},null,512),[[d,o(n).consignee.addressDetailOne]]),R(I,null,{default:ae(()=>[R(f,{type:"date",placeholder:"\u8ACB\u9078\u64C7\u53EF\u6536\u8CA8\u65E5\u671F","is-date-disabled":ve,required:""})]),_:1})])]),l(e("div",po,[mo,e("div",{class:"emap"},[e("button",{onClick:_e}," \u9078\u64C7\u5E97\u8216 ")]),e("div",_o,[l(e("input",{id:"store-name","onUpdate:modelValue":t[9]||(t[9]=s=>o(u).name=s),type:"text",required:"",class:"form-control bold",disabled:""},null,512),[[d,o(u).name]])]),e("div",vo,[l(e("input",{id:"store-address","onUpdate:modelValue":t[10]||(t[10]=s=>o(u).address=s),type:"text",required:"",class:"form-control bold",disabled:""},null,512),[[d,o(u).address]])])],512),[[B,o(n).consignee.deliveryType===o(C).Store]]),e("div",ho,[fo,e("div",yo,[e("label",bo,[l(e("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>x(v)?v.value=s:null),type:"radio",name:"donation",value:!1},null,512),[[m,o(v)]]),i(" \u958B\u7ACB\u767C\u7968 ")]),e("label",go,[l(e("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>x(v)?v.value=s:null),type:"radio",name:"donation",value:!0},null,512),[[m,o(v)]]),i(" \u6350\u8D08\u767C\u7968 ")])])]),e("div",ko,[Po,o(v)?(b(),y("div",Vo,[e("div",Io,[l(e("input",{id:"inv_ship_lovecode","onUpdate:modelValue":t[18]||(t[18]=s=>o(n).invoiceParams.loveCode=s),type:"text",placeholder:"\u8ACB\u8F38\u5165\u6350\u8D08\u611B\u5FC3\u78BC*",class:"form-control",name:"",required:""},null,512),[[d,o(n).invoiceParams.loveCode]])])])):(b(),y("div",xo,[e("div",Co,[l(e("input",{id:"inv_ship_name","onUpdate:modelValue":t[13]||(t[13]=s=>o(n).invoiceParams.customerName=s),type:"text",placeholder:"\u59D3\u540D*",class:"form-control",name:"",required:""},null,512),[[d,o(n).invoiceParams.customerName]]),l(e("input",{id:"inv_ship_email","onUpdate:modelValue":t[14]||(t[14]=s=>o(n).invoiceParams.customerEmail=s),type:"text",placeholder:"Email*",class:"form-control",name:"",required:""},null,512),[[d,o(n).invoiceParams.customerEmail]]),l(e("input",{id:"inv_ship_address","onUpdate:modelValue":t[15]||(t[15]=s=>o(n).invoiceParams.customerAddr=s),type:"text",placeholder:"\u5730\u5740*",class:"form-control",name:"",required:""},null,512),[[d,o(n).invoiceParams.customerAddr]])]),e("label",To,[l(e("input",{id:"change-image","onUpdate:modelValue":t[16]||(t[16]=s=>x(T)?T.value=s:null),type:"checkbox"},null,512),[[F,o(T)]]),i(" \u767C\u7968\u8981\u6253\u7D71\u7DE8 ")]),o(T)?(b(),y("div",Uo,[l(e("input",{id:"","onUpdate:modelValue":t[17]||(t[17]=s=>o(n).invoiceParams.customerIdentifier=s),type:"text",placeholder:"\u8ACB\u8F38\u5165\u7D71\u4E00\u7DE8\u865F",class:"form-control",required:"",name:""},null,512),[[d,o(n).invoiceParams.customerIdentifier]])])):le("",!0)]))]),e("div",No,[wo,e("div",qo,[e("label",Oo,[l(e("input",{id:"change-image","onUpdate:modelValue":t[19]||(t[19]=s=>x(U)?U.value=s:null),type:"checkbox"},null,512),[[F,o(U)]]),i(" \u4F7F\u7528\u8F09\u5177 ")]),o(U)?(b(),y("div",So,[e("label",$o,[l(e("input",{"onUpdate:modelValue":t[20]||(t[20]=s=>o(n).invoiceParams.carruerType=s),type:"radio",name:"uic-member",value:o(M).Member},null,8,Ro),[[m,o(n).invoiceParams.carruerType]]),i(" \u6703\u54E1\u8F09\u5177 ")]),e("label",Do,[l(e("input",{"onUpdate:modelValue":t[21]||(t[21]=s=>o(n).invoiceParams.carruerType=s),type:"radio",name:"uic-npc",value:o(M).NPC},null,8,Mo),[[m,o(n).invoiceParams.carruerType]]),i(" \u81EA\u7136\u4EBA\u6191\u8B49 ")]),e("label",Eo,[l(e("input",{"onUpdate:modelValue":t[22]||(t[22]=s=>o(n).invoiceParams.carruerType=s),type:"radio",name:"uic-mobile",value:o(M).Mobile},null,8,Lo),[[m,o(n).invoiceParams.carruerType]]),i(" \u624B\u6A5F\u689D\u78BC ")]),l(e("input",{id:"inv-carruerNum","onUpdate:modelValue":t[23]||(t[23]=s=>o(n).invoiceParams.carruerNum=s),type:"text",placeholder:"\u8ACB\u8F38\u5165\u5C0D\u61C9\u7684\u8F09\u5177\u7DE8\u865F",class:"form-control",required:"",name:""},null,512),[[d,o(n).invoiceParams.carruerNum]])])):le("",!0)])]),e("div",Ao,[Bo,l(e("textarea",{id:"","onUpdate:modelValue":t[24]||(t[24]=s=>o(n).consignee.remark=s),rows:"6",placeholder:"\u8ACB\u8F38\u5165\u8A02\u55AE\u5099\u8A3B\u5167\u5BB9",class:"form-control",name:""},null,512),[[d,o(n).consignee.remark]])]),e("div",Fo,[Go,e("ul",Ho,[e("li",null," \u5546\u54C1\u91D1\u984D\u5C0F\u8A08 (\u5171"+_(o(V).length)+"\u9805\u5546\u54C1)\uFF1A$"+_(o(E)),1),e("li",null," \u904B\u8CBB\uFF1A"+_(o(z)),1),e("li",null," \u7D05\u5229\u6263\u9EDE\uFF1A"+_(o(k)),1),e("li",zo,[i(" \u8A02\u55AE\u7E3D\u91D1\u984D\uFF1A"),e("span",null,"$"+_(o(E)-o(k)+o(z)),1)])])]),e("div",jo,[e("label",Ko,[l(e("input",{id:"check_service","onUpdate:modelValue":t[25]||(t[25]=s=>x(S)?S.value=s:null),type:"checkbox",required:""},null,512),[[F,o(S)]]),i(" \u6211\u5DF2\u7D93\u95B1\u8B80\u4E26\u540C\u610F\u4EE5\u4E0A\u8CFC\u8CB7\u9808\u77E5\u3001 "),Yo,i("\u8207"),Jo,i("\uFF0C\u6B64\u6B04\u4F4D\u52FE\u9078\u624D\u53EF\u9001\u51FA\u3002 ")])]),Zo,e("div",Qo,[R(he,{type:"button",class:"btn btn-main btn-default",to:"/cart"},{default:ae(()=>[i(" \u4E0A\u4E00\u9801 ")]),_:1}),e("input",{id:"",type:"submit",class:"btn btn-main btn-check check_service_btn submit_home",value:"\u78BA\u8A8D\u9001\u51FA",onClick:pe})])])])}}},lt=ye(Wo,[["__scopeId","data-v-51e0148f"]]);export{lt as default};
