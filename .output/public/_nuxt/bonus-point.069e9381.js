import{a as M,e as T,f as w,g as B,h as P,u as L,i as N,j as U,k as V,P as A}from"./entry.0cbc246d.js";import{u as R}from"./pageStatusStore.e285144a.js";import{b as z,c as k,o as Y,_ as u,aa as t,$ as j,a0 as q,C as _,ac as c,y as a,F,V as G,Z as p,ae as v,a8 as H,a9 as O}from"./swiper-vue.2e988726.js";const d=i=>(H("data-v-683f8159"),i=i(),O(),i),Q={class:"full_height mt185ptb30 bg_left2"},K={class:"container signpoint_content"},Z={class:"text-center mypoint"},J=d(()=>t("i",{class:"fas fa-parking"},null,-1)),W={class:"text-center"},X={id:"signpoint"},y=d(()=>t("div",{class:"mb-20"},null,-1)),ee={class:"signpoint_li"},se=["onClick"],te={class:"t1"},oe={href:"javascript:;"},ne={class:"t2 sign_day"},ae=d(()=>t("div",{class:"mt-20"},null,-1)),ie={__name:"bonus-point",setup(i){const h=T(),b=w(),f=B();P();const g=R(),r=L(),l=z([]),m=k(()=>l.value.reduce((s,o)=>s+(o!=null&&o.accepted?1:0),0)),S=k(()=>m.value),E=s=>s!=null&&s.accepted?s!=null&&s.isMission?"\u4EFB\u52D9\u5DF2\u89E3\u9396":"\u5DF2\u7C3D\u5230":s!=null&&s.isMission?"\u4EFB\u52D9\u89E3\u9396":"\u7C3D\u5230";Y(()=>{f.status.loggedIn||b.push({path:"/login",query:{redirect:"/bonus-point"}}),x()});async function x(){try{const s=await $fetch(`${r.public.apiBase}/${N}`),o=await $fetch(`${r.public.apiBase}/${U}`,{headers:{authorization:"Bearer "+localStorage.getItem("accessToken")}}),n=s.data.map(e=>{const C=o.data.find(D=>D.index===e.index);return{...e,accepted:!!C}});l.value=n}catch(s){console.log(s)}}async function $(s){s.accepted||(s.isMission&&(g.setDailyVideoURL(s.video),g.toggleVideoDialog(!0),await new Promise(o=>{setTimeout(()=>o(),5e3)})),I(s))}async function I(s){var o,n;try{await $fetch(`${r.public.apiBase}/${A(s.index)}`,{method:"POST",headers:{authorization:"Bearer "+localStorage.getItem("accessToken")}}),h.success(`\u7C3D\u5230\u6210\u529F \u7D05\u5229 +${s.credit}`,{duration:2e3})}catch(e){h.error(((n=(o=e==null?void 0:e.data)==null?void 0:o.data)==null?void 0:n.message)==="User already checked in today."?"\u4ECA\u65E5\u5DF2\u7C3D\u5230":"\u7C3D\u5230\u5931\u6557")}x()}return(s,o)=>{const n=V;return p(),u("section",Q,[t("div",K,[t("h4",Z,[j(n,{to:"/bonus-point"},{default:q(()=>{var e;return[_(" \u6211\u7684\u7D05\u5229 "),J,_(" "+c((e=a(f).user)==null?void 0:e.rewardCredit),1)]}),_:1})]),t("div",W,[_(" \u5DF2\u7D2F\u8A08\u7C3D\u5230\uFF1A"+c(a(m))+"\u6B21 ",1),t("div",X,[y,t("ul",ee,[(p(!0),u(F,null,G(a(l),e=>(p(),u("li",{key:e.index,class:v(["day-slot",{sign:e.accepted,"no-cursor":e.accepted||e.index!==a(S),inactive:e.index>a(S),mission:e.isMission,"mission-accepted":e.accepted&&e.isMission}]),onClick:C=>$(e)},[t("span",te,"+"+c(e.credit),1),t("a",oe,[t("i",{class:v(["fa-solid",{"fa-p":!e.isMission,"fa-lock":e.isMission,"fa-unlock":e.accepted&&e.isMission}])},null,2)]),t("span",ne,c(E(e)),1)],10,se))),128))]),ae])])])])}}},ue=M(ie,[["__scopeId","data-v-683f8159"]]);export{ue as default};
