import{_ as he}from"./client-only.73480984.js";import{a as fe,E as ye,q as ge,b as be,u as ke,F as Pe,H as xe,I as Ce,B as Te}from"./entry.c9000b64.js";import{b as y,c as S,o as Ue,q as Ve,P as Ie,_ as U,aa as e,F as Ne,V as we,y as o,J as r,ah as h,C as i,G as E,ae as f,$ as D,i as N,af as p,a0 as ne,ab as z,ai as ae,f as re,Z as V,a8 as $e,a9 as qe}from"./swiper-vue.d582d122.js";import{u as Oe}from"./authStore.1f47292a.js";import{P as w,a as R,D as k,U as M}from"./common.0260327a.js";const m=$=>($e("data-v-2f1ac0e7"),$=$(),qe(),$),Se={class:"full_height mt185ptb30"},De={id:"checkout_form",action:"javascript:;",class:"cart_container"},Re={class:"cart_list"},Me={class:"cart_img"},Ae=["src"],Le={class:"cart_tl"},Be={class:"product-quantity"},Ee={class:"cart_price text-right"},ze={class:"cart_info"},Fe=m(()=>e("h5",null,"\u5BC4\u9001\u65B9\u5F0F",-1)),Ge={class:"checkout-form"},He={class:"radio form-check"},Ze=["value"],Ke={class:"radio form-check"},Ye=["value"],je={class:"cart_info"},Je=m(()=>e("h5",null,"\u4ED8\u6B3E\u65B9\u5F0F",-1)),Qe={class:"checkout-form"},We={class:"radio form-check"},Xe=["value"],eo={class:"radio form-check"},oo=["value"],to={class:"radio form-check"},so=["value"],no={class:"cart_info"},ao={class:"checkout-form"},ro={id:"ship_home_form",class:"cart_info"},lo=m(()=>e("h5",null,"\u6536\u4EF6\u4EBA\u8CC7\u8A0A",-1)),io={class:"ship_info"},co={class:"cart_info checkout-form"},uo=m(()=>e("h5",null,"\u8D85\u5546\u53D6\u8CA8\u8CC7\u8A0A",-1)),po={class:"store-name"},mo={class:"store-address"},vo={class:"cart_info"},_o=m(()=>e("h5",null,"\u8ACB\u9078\u64C7\u767C\u7968\u9078\u9805",-1)),ho={class:"checkout-form"},fo={class:"radio form-check"},yo={class:"radio form-check"},go={key:0,class:"cart_info checkout-form"},bo=m(()=>e("h5",null,"\u767C\u7968\u8CC7\u8A0A",-1)),ko={class:"ship_info inv-info"},Po={class:"ship_info"},xo={class:"cart_info checkout-form"},Co=m(()=>e("h5",null,"\u8F09\u5177\u8CC7\u8A0A",-1)),To={class:"ship_info inv-info"},Uo={class:"checkbox pt10 pb10"},Vo={key:0,class:"ship_info"},Io={class:"radio form-check"},No=["value"],wo={class:"radio form-check"},$o=["value"],qo={class:"radio form-check"},Oo=["value"],So={class:"cart_info checkout-form"},Do=m(()=>e("h5",null,"\u8A02\u55AE\u5099\u8A3B",-1)),Ro={class:"cart_info"},Mo=m(()=>e("h5",null,"\u4ED8\u6B3E\u660E\u7D30",-1)),Ao={class:"cart_check"},Lo={class:"border_top"},Bo={class:"cart_info checkout-form ptb10"},Eo={class:"checkbox"},zo=m(()=>e("a",{href:"/terms",target:"new"},"\u6703\u54E1\u4F7F\u7528\u689D\u6B3E",-1)),Fo=m(()=>e("a",{href:"/privacy",target:"new"},"\u96B1\u79C1\u6B0A\u653F\u7B56",-1)),Go=m(()=>e("div",{class:"text-center mb-20 mt-20"},[e("span",{id:"errormsg"})],-1)),Ho={class:"text-center mb-20 mt-20"},Zo={__name:"checkout",setup($){var Y,j,J,Q,W,X,ee,oe;const le=ye(),ie=ge(),g=be(),q=ke(),l=Oe(),P=Pe(),x=y(0),ce=y(!1),C=y(!1),O=y(!1),v=y(!1),T=y(w.General),A=S({get:()=>I.value.reduce((a,t)=>a+Z(t)*t.amount,0),set:a=>{A.value=a}}),F=S(()=>{var a;return((a=l==null?void 0:l.user)==null?void 0:a.rewardCredit)||0}),I=S(()=>{switch(T.value){case w.ColdChain:return P==null?void 0:P.merch.filter(a=>a.attribute==="COLD_CHAIN");default:return P==null?void 0:P.merch.filter(a=>a.attribute==="GENERAL")}}),G=y({}),d=y({name:"",id:"",outside:0,ship:0,address:""}),H=S(()=>{var t;return(t=G.value)==null?void 0:t.deliveryFee});let L=null;Ue(async()=>{if(ue(),await Ve(),I.value<=0)return ie.push({path:"/"});await B(),L=setInterval(()=>{de()},1e3)}),Ie(()=>{clearInterval(L),L=null});async function B(){try{const a=K(),t=await $fetch(`${q.public.apiBase}/${xe}`,{method:"POST",body:a,headers:{authorization:"Bearer "+localStorage.getItem("accessToken")}});console.log("pre-settlement, ",t),G.value=t.data}catch{}}function de(){d.value.name=localStorage.getItem("storename"),d.value.id=localStorage.getItem("storeid"),d.value.address=localStorage.getItem("storeaddress"),d.value.ship=localStorage.getItem("ship"),d.value.outside=localStorage.getItem("outside")}function ue(){switch(le.query.type){case"cold-chain":T.value=w.ColdChain;break;default:T.value=w.General;break}}const Z=a=>{var t,c;return((t=l==null?void 0:l.user)==null?void 0:t.memberLevel)==="SVIP"?a==null?void 0:a.svipPrice:((c=l==null?void 0:l.user)==null?void 0:c.memberLevel)==="VIP"?a==null?void 0:a.vipPrice:l.status.loggedIn?a==null?void 0:a.memberPrice:a==null?void 0:a.price},s=y({attribute:T.value,choosePayment:R.CreditOneTime,consignee:{deliveryType:k.Home,city:"",email:(Y=l.user)==null?void 0:Y.email,idNo:"",idType:"1",cellphone:(j=l.user)==null?void 0:j.cellphone,name:(J=l.user)==null?void 0:J.nickname,remark:"",senderRemark:"",stationCode:"",stationName:"",addressDetailOne:(Q=l.user)==null?void 0:Q.addressOne,province:"",district:"",town:"",zipCode:""},invoiceParams:{customerName:(W=l.user)==null?void 0:W.nickname,customerEmail:(X=l.user)==null?void 0:X.email,customerPhone:(ee=l.user)==null?void 0:ee.cellphone,customerAddr:(oe=l.user)==null?void 0:oe.addressOne,customerIdentifier:"",carruerType:M.Member,carruerNum:"",donation:"0",loveCode:""},products:[],bonusPointRedemption:0});function K(){var t,c;return{...s.value,attribute:T.value,consignee:{...s.value.consignee,stationCode:s.value.consignee.deliveryType===k.Store?(t=d.value)==null?void 0:t.id:"",stationName:s.value.consignee.deliveryType===k.Store?(c=d.value)==null?void 0:c.name:""},invoiceParams:{...s.value.invoiceParams,carruerType:C.value?s.value.invoiceParams.carruerNum:"",carruerNum:s.value.invoiceParams.carruerType>=2?s.value.invoiceParams.carruerNum:"",donation:v.value?1:0,loveCode:v.value?s.value.invoiceParams.loveCode:"",customerIdentifier:ce.value?s.value.invoiceParams.customerIdentifier:"00000000",customerPhone:s.value.consignee.cellphone,customerName:s.value.consignee.name,customerAddr:s.value.consignee.addressDetailOne},bonusPointRedemption:x.value,products:I.value.map(_=>({id:_.id,quantity:_.amount}))}}async function pe(){if(!me())return;const t=K();console.log(t);try{const c=`${q.public.baseUrl}/order?payment=successful`,_=await $fetch(`${q.public.apiBase}/${Ce}?order_result_url=${c}`,{method:"POST",body:t,headers:{authorization:"Bearer "+localStorage.getItem("accessToken")}});g.loading("\u5373\u5C07\u5C0E\u5411\u4ED8\u6B3E\u9801\u9762\uFF0C\u8ACB\u7A0D\u5019...");const u=document.createElement("credit-div");u.innerHTML=_,u.id="credit-payment",document.body.appendChild(u),document.getElementById("_form_aiochk").submit(),console.log(_)}catch(c){g.error(c.data)}}function me(){var a,t,c,_;if(!s.value.consignee.name||!s.value.consignee.cellphone||!s.value.consignee.addressDetailOne||!s.value.consignee.province||!s.value.consignee.district||!s.value.consignee.city||!s.value.consignee.zipCode)return g.error("\u8ACB\u78BA\u5BE6\u586B\u5BEB\u6536\u4EF6\u4EBA\u8CC7\u8A0A"),!1;if(s.value.consignee.deliveryType===k.Store&&(!d.value.id||!d.value.name))return g.error("\u8ACB\u9078\u64C7\u6B32\u53D6\u8CA8\u7684\u5E97\u5BB6"),!1;if((t=(a=s.value)==null?void 0:a.consignee)!=null&&t.cellphone){const u=(_=(c=s.value)==null?void 0:c.consignee)==null?void 0:_.cellphone;if(!/^[0-9]{10}$/g.test(u)){g.error("\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u624B\u6A5F\u683C\u5F0F ex.0912345678");return}}if(v.value){const u=/^\d{3,7}$/,b=s.value.invoiceParams.loveCode;if(!u.test(b)){g.error("\u611B\u5FC3\u78BC\u8ACB\u8F38\u51653-7\u78BC\u7684\u6578\u5B57\u7D44\u5408");return}}if(C.value){let u,b;s.value.invoiceParams.carruerType===2&&(u=/^[a-zA-Z]{2}[0-9]{14}$/,b="16\u78BC\u7684\u82F1\u6578\u7D44\u5408"),s.value.invoiceParams.carruerType===3&&(u=/^\/{1}[0-9A-Z]{7}$/,b="8\u78BC\u7684\u82F1\u6578\u7D44\u5408");const n=s.value.invoiceParams.carruerNum;if(s.value.invoiceParams.carruerType>=2&&!u.test(n)){g.error(`\u8ACB\u8F38\u5165\u7B26\u5408\u683C\u5F0F\u7684\u8F09\u5177\u8CC7\u6599(${b})`);return}}return O.value?!0:(g.error("\u8ACB\u8A73\u95B1\u76F8\u95DC\u8CFC\u8CB7\u689D\u6B3E\u4E26\u52FE\u9078\u78BA\u8A8D"),!1)}function ve(){const a=`${q.public.baseUrl}`;window.open(`https://emap.presco.com.tw/c2cemap.ashx?eshopid=870&&servicetype=1&url=${a}/cvs_callback`)}function _e(a){return a<Date.now()}return(a,t)=>{const c=re("n-input-number"),_=re("n-date-picker"),u=he,b=Te;return V(),U("div",Se,[e("form",De,[e("table",Re,[e("tbody",null,[(V(!0),U(Ne,null,we(o(I),n=>{var te,se;return V(),U("tr",{key:n.id,class:"prod-tr"},[e("td",Me,[e("img",{src:n==null?void 0:n.coverImg},null,8,Ae)]),e("td",Le,[e("h5",null,f(n==null?void 0:n.name),1),e("div",Be," x"+f(n==null?void 0:n.amount),1)]),e("td",Ee,[r(e("span",null,"\u5E02\u50F9 $"+f(n==null?void 0:n.price),513),[[E,((te=o(l).user)==null?void 0:te.memberLevel)&&((se=o(l).user)==null?void 0:se.memberLevel)!=="NORMAL"]]),i(" \u50F9\u9322 $"+f(Z(n)),1)])])}),128))])]),e("div",ze,[Fe,e("div",Ge,[e("label",He,[r(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>o(s).consignee.deliveryType=n),type:"radio",name:"shipping",value:o(k).Home,onClick:B},null,8,Ze),[[h,o(s).consignee.deliveryType]]),i(" \u5B85\u914D\u5230\u5E9C ")]),r(e("label",Ke,[r(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>o(s).consignee.deliveryType=n),type:"radio",name:"shipping",value:o(k).Store,onClick:B},null,8,Ye),[[h,o(s).consignee.deliveryType]]),i(" \u8D85\u5546\u53D6\u8CA8 ")],512),[[E,o(T)===o(w).General]])])]),e("div",je,[Je,e("div",Qe,[e("label",We,[r(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>o(s).choosePayment=n),type:"radio",name:"payment",value:o(R).CreditOneTime},null,8,Xe),[[h,o(s).choosePayment]]),i(" \u4FE1\u7528\u5361 ")]),e("label",eo,[r(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>o(s).choosePayment=n),type:"radio",name:"payment",value:o(R).BarCode},null,8,oo),[[h,o(s).choosePayment]]),i(" \u8D85\u5546\u689D\u78BC\u4ED8\u6B3E ")]),e("label",to,[r(e("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>o(s).choosePayment=n),type:"radio",value:o(R).Cvs,name:"payment"},null,8,so),[[h,o(s).choosePayment]]),i(" \u8D85\u5546\u4EE3\u78BC\u4ED8\u6B3E ")])])]),e("div",no,[e("h5",null,"\u7D05\u5229\u6263\u9EDE (\u76EE\u524D\u53EF\u7528\u7D05\u5229\uFF1A"+f(o(F))+" \u9EDE)",1),e("div",ao,[D(c,{value:o(x),"onUpdate:value":t[5]||(t[5]=n=>N(x)?x.value=n:null),min:"0",max:o(F),style:{width:"150px",margin:"4px 0 4px 15px"}},null,8,["value","max"])])]),e("div",ro,[lo,e("div",io,[r(e("input",{id:"ship_name-2","onUpdate:modelValue":t[6]||(t[6]=n=>o(s).consignee.name=n),type:"text",placeholder:"\u59D3\u540D*",class:"form-control",name:"ship_name-2",required:""},null,512),[[p,o(s).consignee.name]]),r(e("input",{id:"ship_phone-2","onUpdate:modelValue":t[7]||(t[7]=n=>o(s).consignee.cellphone=n),type:"text",placeholder:"\u624B\u6A5F*",class:"form-control",name:"ship_phone-2",required:""},null,512),[[p,o(s).consignee.cellphone]]),r(e("input",{id:"ship-province","onUpdate:modelValue":t[8]||(t[8]=n=>o(s).consignee.province=n),type:"text",placeholder:"\u7701*",class:"form-control",name:"ship-province",required:""},null,512),[[p,o(s).consignee.province]]),r(e("input",{id:"ship-district","onUpdate:modelValue":t[9]||(t[9]=n=>o(s).consignee.district=n),type:"text",placeholder:"\u884C\u653F\u5340*",class:"form-control",name:"ship-district",required:""},null,512),[[p,o(s).consignee.district]]),r(e("input",{id:"ship-city","onUpdate:modelValue":t[10]||(t[10]=n=>o(s).consignee.city=n),type:"text",placeholder:"\u57CE\u5E02*",class:"form-control",name:"ship-city",required:""},null,512),[[p,o(s).consignee.city]]),r(e("input",{id:"ship-zipCode","onUpdate:modelValue":t[11]||(t[11]=n=>o(s).consignee.zipCode=n),type:"text",placeholder:"\u90F5\u905E\u5340\u865F*",class:"form-control",name:"ship-zipCode",required:""},null,512),[[p,o(s).consignee.zipCode]]),r(e("input",{id:"ship-address-home","onUpdate:modelValue":t[12]||(t[12]=n=>o(s).consignee.addressDetailOne=n),type:"text",placeholder:"\u6536\u4EF6\u5730\u5740*",class:"form-control",name:"ship-address-home",required:""},null,512),[[p,o(s).consignee.addressDetailOne]]),D(u,null,{default:ne(()=>[D(_,{type:"date",placeholder:"\u8ACB\u9078\u64C7\u53EF\u6536\u8CA8\u65E5\u671F","is-date-disabled":_e,required:""})]),_:1})])]),r(e("div",co,[uo,e("div",{class:"emap"},[e("button",{onClick:ve}," \u9078\u64C7\u5E97\u8216 ")]),e("div",po,[r(e("input",{id:"store-name","onUpdate:modelValue":t[13]||(t[13]=n=>o(d).name=n),type:"text",required:"",class:"form-control bold",disabled:""},null,512),[[p,o(d).name]])]),e("div",mo,[r(e("input",{id:"store-address","onUpdate:modelValue":t[14]||(t[14]=n=>o(d).address=n),type:"text",required:"",class:"form-control bold",disabled:""},null,512),[[p,o(d).address]])])],512),[[E,o(s).consignee.deliveryType===o(k).Store]]),e("div",vo,[_o,e("div",ho,[e("label",fo,[r(e("input",{"onUpdate:modelValue":t[15]||(t[15]=n=>N(v)?v.value=n:null),type:"radio",name:"donation",value:!1},null,512),[[h,o(v)]]),i(" \u958B\u7ACB\u767C\u7968 ")]),e("label",yo,[r(e("input",{"onUpdate:modelValue":t[16]||(t[16]=n=>N(v)?v.value=n:null),type:"radio",name:"donation",value:!0},null,512),[[h,o(v)]]),i(" \u6350\u8D08\u767C\u7968 ")])])]),o(v)?(V(),U("div",go,[bo,e("div",ko,[e("div",Po,[r(e("input",{id:"inv_ship_lovecode","onUpdate:modelValue":t[17]||(t[17]=n=>o(s).invoiceParams.loveCode=n),type:"text",placeholder:"\u8ACB\u8F38\u5165\u6350\u8D08\u611B\u5FC3\u78BC*",class:"form-control",name:"",required:""},null,512),[[p,o(s).invoiceParams.loveCode]])])])])):z("",!0),e("div",xo,[Co,e("div",To,[e("label",Uo,[r(e("input",{id:"change-image","onUpdate:modelValue":t[18]||(t[18]=n=>N(C)?C.value=n:null),type:"checkbox"},null,512),[[ae,o(C)]]),i(" \u4F7F\u7528\u8F09\u5177 ")]),o(C)?(V(),U("div",Vo,[e("label",Io,[r(e("input",{"onUpdate:modelValue":t[19]||(t[19]=n=>o(s).invoiceParams.carruerType=n),type:"radio",name:"uic-member",value:o(M).Member},null,8,No),[[h,o(s).invoiceParams.carruerType]]),i(" \u6703\u54E1\u8F09\u5177 ")]),e("label",wo,[r(e("input",{"onUpdate:modelValue":t[20]||(t[20]=n=>o(s).invoiceParams.carruerType=n),type:"radio",name:"uic-npc",value:o(M).NPC},null,8,$o),[[h,o(s).invoiceParams.carruerType]]),i(" \u81EA\u7136\u4EBA\u6191\u8B49 ")]),e("label",qo,[r(e("input",{"onUpdate:modelValue":t[21]||(t[21]=n=>o(s).invoiceParams.carruerType=n),type:"radio",name:"uic-mobile",value:o(M).Mobile},null,8,Oo),[[h,o(s).invoiceParams.carruerType]]),i(" \u624B\u6A5F\u689D\u78BC ")]),o(s).invoiceParams.carruerType>=2?r((V(),U("input",{key:0,id:"inv-carruerNum","onUpdate:modelValue":t[22]||(t[22]=n=>o(s).invoiceParams.carruerNum=n),type:"text",placeholder:"\u8ACB\u8F38\u5165\u5C0D\u61C9\u7684\u8F09\u5177\u7DE8\u865F",class:"form-control",required:"",name:""},null,512)),[[p,o(s).invoiceParams.carruerNum]]):z("",!0)])):z("",!0)])]),e("div",So,[Do,r(e("textarea",{id:"","onUpdate:modelValue":t[23]||(t[23]=n=>o(s).consignee.remark=n),rows:"6",placeholder:"\u8ACB\u8F38\u5165\u8A02\u55AE\u5099\u8A3B\u5167\u5BB9",class:"form-control",name:""},null,512),[[p,o(s).consignee.remark]])]),e("div",Ro,[Mo,e("ul",Ao,[e("li",null," \u5546\u54C1\u91D1\u984D\u5C0F\u8A08 (\u5171"+f(o(I).length)+"\u9805\u5546\u54C1)\uFF1A$"+f(o(A)),1),e("li",null," \u904B\u8CBB\uFF1A"+f(o(H)),1),e("li",null," \u7D05\u5229\u6263\u9EDE\uFF1A"+f(o(x)),1),e("li",Lo,[i(" \u8A02\u55AE\u7E3D\u91D1\u984D\uFF1A"),e("span",null,"$"+f(o(A)-o(x)+o(H)),1)])])]),e("div",Bo,[e("label",Eo,[r(e("input",{id:"check_service","onUpdate:modelValue":t[24]||(t[24]=n=>N(O)?O.value=n:null),type:"checkbox",required:""},null,512),[[ae,o(O)]]),i(" \u6211\u5DF2\u7D93\u95B1\u8B80\u4E26\u540C\u610F\u4EE5\u4E0A\u8CFC\u8CB7\u9808\u77E5\u3001 "),zo,i("\u8207"),Fo,i("\uFF0C\u6B64\u6B04\u4F4D\u52FE\u9078\u624D\u53EF\u9001\u51FA\u3002 ")])]),Go,e("div",Ho,[D(b,{type:"button",class:"btn btn-main btn-default",to:"/cart"},{default:ne(()=>[i(" \u4E0A\u4E00\u9801 ")]),_:1}),e("input",{id:"",type:"submit",class:"btn btn-main btn-check check_service_btn submit_home",value:"\u78BA\u8A8D\u9001\u51FA",onClick:pe})])])])}}},Wo=fe(Zo,[["__scopeId","data-v-2f1ac0e7"]]);export{Wo as default};
