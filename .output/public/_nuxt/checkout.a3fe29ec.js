import{_ as Te}from"./client-only.2d3cf038.js";import{a as xe,E as Ce,q as Ue,b as Ve,u as Ie,F as Se,H as Ne,I as $e,B as we}from"./entry.b37249e1.js";import{b as m,c as A,o as qe,q as De,P as Oe,_ as N,aa as e,F as Me,V as Re,y as o,J as r,ah as f,C as i,G as K,ae as g,$ as B,i as T,af as v,a0 as Y,ab as $,ai as pe,f as E,Z as k,a3 as j,a8 as Ae,a9 as Be}from"./swiper-vue.cf16a99e.js";import{u as Ee}from"./authStore.ff99c219.js";import{P as D,a as L,D as h,U as z}from"./common.cb49f5bd.js";const _=O=>(Ae("data-v-9922b3c4"),O=O(),Be(),O),Le={class:"full_height mt185ptb30"},ze={id:"checkout_form",action:"javascript:;",class:"cart_container"},He={class:"cart_list"},Fe={class:"cart_img"},Ge=["src"],Ze={class:"cart_tl"},Ke={class:"product-quantity"},Ye={class:"cart_price text-right"},je={class:"cart_info"},Je=_(()=>e("h5",null,"\u5BC4\u9001\u65B9\u5F0F",-1)),Qe={class:"checkout-form"},We={class:"radio form-check"},Xe=["value"],eo={class:"radio form-check"},oo=["value"],to={class:"cart_info"},no=_(()=>e("h5",null,"\u4ED8\u6B3E\u65B9\u5F0F",-1)),so={class:"checkout-form"},ao={class:"radio form-check"},ro=["value"],lo={class:"radio form-check"},io=["value"],co={class:"radio form-check"},uo=["value"],po={class:"cart_info"},mo={class:"checkout-form"},vo={id:"ship_home_form",class:"cart_info"},_o=_(()=>e("h5",null,"\u6536\u4EF6\u4EBA\u8CC7\u8A0A",-1)),ho={class:"ship_info"},yo={class:"cart_info checkout-form"},fo=_(()=>e("h5",null,"\u8D85\u5546\u53D6\u8CA8\u8CC7\u8A0A",-1)),go={class:"store-name"},bo={class:"store-address"},ko={class:"cart_info"},Po=_(()=>e("h5",null,"\u8ACB\u9078\u64C7\u767C\u7968\u9078\u9805",-1)),To={class:"checkout-form"},xo={class:"radio form-check"},Co={class:"radio form-check"},Uo={key:0,class:"cart_info checkout-form"},Vo=_(()=>e("h5",null,"\u767C\u7968\u8CC7\u8A0A",-1)),Io={class:"ship_info inv-info"},So={class:"ship_info"},No={class:"cart_info checkout-form"},$o=_(()=>e("h5",null,"\u8F09\u5177\u8CC7\u8A0A",-1)),wo={class:"ship_info inv-info"},qo={class:"checkbox pt10 pb10"},Do={key:0,class:"ship_info"},Oo={class:"radio form-check"},Mo=["value"],Ro={class:"radio form-check"},Ao=["value"],Bo={class:"radio form-check"},Eo=["value"],Lo={class:"cart_info checkout-form"},zo=_(()=>e("h5",null,"\u8A02\u55AE\u5099\u8A3B",-1)),Ho={class:"cart_info"},Fo=_(()=>e("h5",null,"\u4ED8\u6B3E\u660E\u7D30",-1)),Go={class:"cart_check"},Zo={class:"border_top"},Ko={class:"cart_info checkout-form ptb10"},Yo={class:"checkbox"},jo=_(()=>e("a",{href:"/terms",target:"new"},"\u6703\u54E1\u4F7F\u7528\u689D\u6B3E",-1)),Jo=_(()=>e("a",{href:"/privacy",target:"new"},"\u96B1\u79C1\u6B0A\u653F\u7B56",-1)),Qo=_(()=>e("div",{class:"text-center mb-20 mt-20"},[e("span",{id:"errormsg"})],-1)),Wo={class:"text-center mb-20 mt-20"},Xo={__name:"checkout",setup(O){var te,ne,se,ae,re,le,ie,ce;const me=Ce(),ve=Ue(),b=Ve(),M=Ie(),l=Ee(),C=Se(),U=m(0),_e=m(!1),V=m(!1),w=m(),x=m(),I=m(),R=m(!1),y=m(!1),S=m(D.General),H=A({get:()=>q.value.reduce((a,t)=>a+X(t)*t.amount,0),set:a=>{H.value=a}}),J=A(()=>{var a;return((a=l==null?void 0:l.user)==null?void 0:a.rewardCredit)||0}),q=A(()=>{switch(S.value){case D.ColdChain:return C==null?void 0:C.merch.filter(a=>a.attribute==="COLD_CHAIN");default:return C==null?void 0:C.merch.filter(a=>a.attribute==="GENERAL")}}),Q=m({}),d=m({name:"",id:"",outside:0,ship:0,address:""}),W=A(()=>{var t;return(t=Q.value)==null?void 0:t.deliveryFee});let F=null;qe(async()=>{if(ye(),await De(),q.value<=0)return ve.push({path:"/"});await G(),F=setInterval(()=>{he()},1e3)}),Oe(()=>{clearInterval(F),F=null});async function G(){try{const a=ee(),t=await $fetch(`${M.public.apiBase}/${Ne}`,{method:"POST",body:a,headers:{authorization:"Bearer "+localStorage.getItem("accessToken")}});console.log("pre-settlement, ",t),Q.value=t.data}catch{}}function he(){d.value.name=localStorage.getItem("storename"),d.value.id=localStorage.getItem("storeid"),d.value.address=localStorage.getItem("storeaddress"),d.value.ship=localStorage.getItem("ship"),d.value.outside=localStorage.getItem("outside")}function ye(){switch(me.query.type){case"cold-chain":S.value=D.ColdChain;break;default:S.value=D.General;break}}const X=a=>{var t,c;return((t=l==null?void 0:l.user)==null?void 0:t.memberLevel)==="SVIP"?a==null?void 0:a.svipPrice:((c=l==null?void 0:l.user)==null?void 0:c.memberLevel)==="VIP"?a==null?void 0:a.vipPrice:l.status.loggedIn?a==null?void 0:a.memberPrice:a==null?void 0:a.price},n=m({attribute:S.value,choosePayment:L.CreditOneTime,consignee:{deliveryType:h.Home,city:"",email:(te=l.user)==null?void 0:te.email,idNo:"",idType:"1",cellphone:(ne=l.user)==null?void 0:ne.cellphone,name:(se=l.user)==null?void 0:se.nickname,remark:"",senderRemark:"",stationCode:"",stationName:"",addressDetailOne:(ae=l.user)==null?void 0:ae.addressOne,province:"",district:"",town:"",zipCode:""},invoiceParams:{customerName:(re=l.user)==null?void 0:re.nickname,customerEmail:(le=l.user)==null?void 0:le.email,customerPhone:(ie=l.user)==null?void 0:ie.cellphone,customerAddr:(ce=l.user)==null?void 0:ce.addressOne,customerIdentifier:"",carruerType:z.Member,carruerNum:"",donation:"0",loveCode:""},products:[],bonusPointRedemption:0,requiredDeliveryTimeslots:[{date:"2023-03-02T00:00:00Z",slot:"14:00-18:00"}]});function ee(){var t,c;return{...n.value,attribute:S.value,consignee:{...n.value.consignee,stationCode:n.value.consignee.deliveryType===h.Store?(t=d.value)==null?void 0:t.id:"",stationName:n.value.consignee.deliveryType===h.Store?(c=d.value)==null?void 0:c.name:""},invoiceParams:{...n.value.invoiceParams,carruerType:V.value?n.value.invoiceParams.carruerNum:"",carruerNum:n.value.invoiceParams.carruerType>=2?n.value.invoiceParams.carruerNum:"",donation:y.value?1:0,loveCode:y.value?n.value.invoiceParams.loveCode:"",customerIdentifier:_e.value?n.value.invoiceParams.customerIdentifier:"00000000",customerPhone:n.value.consignee.cellphone,customerName:n.value.consignee.name,customerAddr:n.value.consignee.addressDetailOne},bonusPointRedemption:U.value,products:q.value.map(p=>({id:p.id,quantity:p.amount})),requiredDeliveryTimeslots:[{date:new Date(w.value).toISOString(),slot:`${oe(x.value)}-${oe(I.value)}`}]}}function oe(a){const t=new Date(a),c=t.getHours(),p=t.getMinutes();return`${c.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`}async function fe(){if(!ge())return;const t=ee();console.log(t,x.value,I.value);try{const c=`${M.public.baseUrl}/order?payment=successful`,p=await $fetch(`${M.public.apiBase}/${$e}?order_result_url=${c}`,{method:"POST",body:t,headers:{authorization:"Bearer "+localStorage.getItem("accessToken")}});b.loading("\u5373\u5C07\u5C0E\u5411\u4ED8\u6B3E\u9801\u9762\uFF0C\u8ACB\u7A0D\u5019...");const u=document.createElement("credit-div");u.innerHTML=p,u.id="credit-payment",document.body.appendChild(u),document.getElementById("_form_aiochk").submit(),console.log(p)}catch(c){b.error(c.data)}}function ge(){var a,t,c,p;if(!n.value.consignee.name||!n.value.consignee.cellphone||!n.value.consignee.addressDetailOne||!n.value.consignee.province||!n.value.consignee.district||!n.value.consignee.city||!n.value.consignee.zipCode)return b.error("\u8ACB\u78BA\u5BE6\u586B\u5BEB\u6536\u4EF6\u4EBA\u8CC7\u8A0A"),!1;if(n.value.consignee.deliveryType===h.Store&&(!d.value.id||!d.value.name))return b.error("\u8ACB\u9078\u64C7\u6B32\u53D6\u8CA8\u7684\u5E97\u5BB6"),!1;if(n.value.consignee.deliveryType===h.Home&&(!w.value||!x.value||!I.value))return b.error("\u8ACB\u9078\u64C7\u53EF\u53D6\u8CA8\u7684\u6642\u9593\u5340\u6BB5"),!1;if((t=(a=n.value)==null?void 0:a.consignee)!=null&&t.cellphone){const u=(p=(c=n.value)==null?void 0:c.consignee)==null?void 0:p.cellphone;if(!/^[0-9]{10}$/g.test(u)){b.error("\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u624B\u6A5F\u683C\u5F0F ex.0912345678");return}}if(y.value){const u=/^\d{3,7}$/,P=n.value.invoiceParams.loveCode;if(!u.test(P)){b.error("\u611B\u5FC3\u78BC\u8ACB\u8F38\u51653-7\u78BC\u7684\u6578\u5B57\u7D44\u5408");return}}if(V.value){let u,P;n.value.invoiceParams.carruerType===2&&(u=/^[a-zA-Z]{2}[0-9]{14}$/,P="16\u78BC\u7684\u82F1\u6578\u7D44\u5408"),n.value.invoiceParams.carruerType===3&&(u=/^\/{1}[0-9A-Z]{7}$/,P="8\u78BC\u7684\u82F1\u6578\u7D44\u5408");const Z=n.value.invoiceParams.carruerNum;if(n.value.invoiceParams.carruerType>=2&&!u.test(Z)){b.error(`\u8ACB\u8F38\u5165\u7B26\u5408\u683C\u5F0F\u7684\u8F09\u5177\u8CC7\u6599(${P})`);return}}return R.value?!0:(b.error("\u8ACB\u8A73\u95B1\u76F8\u95DC\u8CFC\u8CB7\u689D\u6B3E\u4E26\u52FE\u9078\u78BA\u8A8D"),!1)}function be(){const a=`${M.public.baseUrl}`;window.open(`https://emap.presco.com.tw/c2cemap.ashx?eshopid=870&&servicetype=1&url=${a}/cvs_callback`)}function ke(a){return a<Date.now()}return(a,t)=>{const c=E("n-input-number"),p=E("n-date-picker"),u=E("n-time-picker"),P=E("n-space"),Z=Te,Pe=we;return k(),N("div",Le,[e("form",ze,[e("table",He,[e("tbody",null,[(k(!0),N(Me,null,Re(o(q),s=>{var ue,de;return k(),N("tr",{key:s.id,class:"prod-tr"},[e("td",Fe,[e("img",{src:s==null?void 0:s.coverImg},null,8,Ge)]),e("td",Ze,[e("h5",null,g(s==null?void 0:s.name),1),e("div",Ke," x"+g(s==null?void 0:s.amount),1)]),e("td",Ye,[r(e("span",null,"\u5E02\u50F9 $"+g(s==null?void 0:s.price),513),[[K,((ue=o(l).user)==null?void 0:ue.memberLevel)&&((de=o(l).user)==null?void 0:de.memberLevel)!=="NORMAL"]]),i(" \u50F9\u9322 $"+g(X(s)),1)])])}),128))])]),e("div",je,[Je,e("div",Qe,[e("label",We,[r(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>o(n).consignee.deliveryType=s),type:"radio",name:"shipping",value:o(h).Home,onClick:G},null,8,Xe),[[f,o(n).consignee.deliveryType]]),i(" \u5B85\u914D\u5230\u5E9C ")]),r(e("label",eo,[r(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>o(n).consignee.deliveryType=s),type:"radio",name:"shipping",value:o(h).Store,onClick:G},null,8,oo),[[f,o(n).consignee.deliveryType]]),i(" \u8D85\u5546\u53D6\u8CA8 ")],512),[[K,o(S)===o(D).General]])])]),e("div",to,[no,e("div",so,[e("label",ao,[r(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>o(n).choosePayment=s),type:"radio",name:"payment",value:o(L).CreditOneTime},null,8,ro),[[f,o(n).choosePayment]]),i(" \u4FE1\u7528\u5361 ")]),e("label",lo,[r(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o(n).choosePayment=s),type:"radio",name:"payment",value:o(L).BarCode},null,8,io),[[f,o(n).choosePayment]]),i(" \u8D85\u5546\u689D\u78BC\u4ED8\u6B3E ")]),e("label",co,[r(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o(n).choosePayment=s),type:"radio",value:o(L).Cvs,name:"payment"},null,8,uo),[[f,o(n).choosePayment]]),i(" \u8D85\u5546\u4EE3\u78BC\u4ED8\u6B3E ")])])]),e("div",po,[e("h5",null,"\u7D05\u5229\u6263\u9EDE (\u76EE\u524D\u53EF\u7528\u7D05\u5229\uFF1A"+g(o(J))+" \u9EDE)",1),e("div",mo,[B(c,{value:o(U),"onUpdate:value":t[5]||(t[5]=s=>T(U)?U.value=s:null),min:"0",max:o(J),style:{width:"150px",margin:"4px 0 4px 15px"}},null,8,["value","max"])])]),e("div",vo,[_o,e("div",ho,[r(e("input",{id:"ship_name-2","onUpdate:modelValue":t[6]||(t[6]=s=>o(n).consignee.name=s),type:"text",placeholder:"\u59D3\u540D*",class:"form-control",name:"ship_name-2",required:""},null,512),[[v,o(n).consignee.name]]),r(e("input",{id:"ship_phone-2","onUpdate:modelValue":t[7]||(t[7]=s=>o(n).consignee.cellphone=s),type:"text",placeholder:"\u624B\u6A5F*",class:"form-control",name:"ship_phone-2",required:""},null,512),[[v,o(n).consignee.cellphone]]),r(e("input",{id:"ship-province","onUpdate:modelValue":t[8]||(t[8]=s=>o(n).consignee.province=s),type:"text",placeholder:"\u7701*",class:"form-control",name:"ship-province",required:""},null,512),[[v,o(n).consignee.province]]),r(e("input",{id:"ship-district","onUpdate:modelValue":t[9]||(t[9]=s=>o(n).consignee.district=s),type:"text",placeholder:"\u884C\u653F\u5340*",class:"form-control",name:"ship-district",required:""},null,512),[[v,o(n).consignee.district]]),r(e("input",{id:"ship-city","onUpdate:modelValue":t[10]||(t[10]=s=>o(n).consignee.city=s),type:"text",placeholder:"\u57CE\u5E02*",class:"form-control",name:"ship-city",required:""},null,512),[[v,o(n).consignee.city]]),r(e("input",{id:"ship-zipCode","onUpdate:modelValue":t[11]||(t[11]=s=>o(n).consignee.zipCode=s),type:"text",placeholder:"\u90F5\u905E\u5340\u865F*",class:"form-control",name:"ship-zipCode",required:""},null,512),[[v,o(n).consignee.zipCode]]),r(e("input",{id:"ship-address-home","onUpdate:modelValue":t[12]||(t[12]=s=>o(n).consignee.addressDetailOne=s),type:"text",placeholder:"\u6536\u4EF6\u5730\u5740*",class:"form-control",name:"ship-address-home",required:""},null,512),[[v,o(n).consignee.addressDetailOne]]),B(Z,null,{default:Y(()=>[o(n).consignee.deliveryType!==o(h).Store?(k(),j(p,{key:0,value:o(w),"onUpdate:value":t[13]||(t[13]=s=>T(w)?w.value=s:null),type:"date",placeholder:"\u8ACB\u9078\u64C7\u53EF\u6536\u8CA8\u65E5\u671F","is-date-disabled":ke,required:""},null,8,["value"])):$("",!0),B(P,null,{default:Y(()=>[o(n).consignee.deliveryType!==o(h).Store?(k(),j(u,{key:0,value:o(x),"onUpdate:value":t[14]||(t[14]=s=>T(x)?x.value=s:null),format:"h:mm a",placeholder:"\u6536\u8CA8\u6642\u9593\u9EDE-\u958B\u59CB",required:""},null,8,["value"])):$("",!0),o(n).consignee.deliveryType!==o(h).Store?(k(),j(u,{key:1,value:o(I),"onUpdate:value":t[15]||(t[15]=s=>T(I)?I.value=s:null),format:"h:mm a",disabled:!o(x),placeholder:"\u6536\u8CA8\u6642\u9593-\u7D50\u675F",required:""},null,8,["value","disabled"])):$("",!0)]),_:1})]),_:1})])]),r(e("div",yo,[fo,e("div",{class:"emap"},[e("button",{onClick:be}," \u9078\u64C7\u5E97\u8216 ")]),e("div",go,[r(e("input",{id:"store-name","onUpdate:modelValue":t[16]||(t[16]=s=>o(d).name=s),type:"text",required:"",class:"form-control bold",disabled:""},null,512),[[v,o(d).name]])]),e("div",bo,[r(e("input",{id:"store-address","onUpdate:modelValue":t[17]||(t[17]=s=>o(d).address=s),type:"text",required:"",class:"form-control bold",disabled:""},null,512),[[v,o(d).address]])])],512),[[K,o(n).consignee.deliveryType===o(h).Store]]),e("div",ko,[Po,e("div",To,[e("label",xo,[r(e("input",{"onUpdate:modelValue":t[18]||(t[18]=s=>T(y)?y.value=s:null),type:"radio",name:"donation",value:!1},null,512),[[f,o(y)]]),i(" \u958B\u7ACB\u767C\u7968 ")]),e("label",Co,[r(e("input",{"onUpdate:modelValue":t[19]||(t[19]=s=>T(y)?y.value=s:null),type:"radio",name:"donation",value:!0},null,512),[[f,o(y)]]),i(" \u6350\u8D08\u767C\u7968 ")])])]),o(y)?(k(),N("div",Uo,[Vo,e("div",Io,[e("div",So,[r(e("input",{id:"inv_ship_lovecode","onUpdate:modelValue":t[20]||(t[20]=s=>o(n).invoiceParams.loveCode=s),type:"text",placeholder:"\u8ACB\u8F38\u5165\u6350\u8D08\u611B\u5FC3\u78BC*",class:"form-control",name:"",required:""},null,512),[[v,o(n).invoiceParams.loveCode]])])])])):$("",!0),e("div",No,[$o,e("div",wo,[e("label",qo,[r(e("input",{id:"change-image","onUpdate:modelValue":t[21]||(t[21]=s=>T(V)?V.value=s:null),type:"checkbox"},null,512),[[pe,o(V)]]),i(" \u4F7F\u7528\u8F09\u5177 ")]),o(V)?(k(),N("div",Do,[e("label",Oo,[r(e("input",{"onUpdate:modelValue":t[22]||(t[22]=s=>o(n).invoiceParams.carruerType=s),type:"radio",name:"uic-member",value:o(z).Member},null,8,Mo),[[f,o(n).invoiceParams.carruerType]]),i(" \u6703\u54E1\u8F09\u5177 ")]),e("label",Ro,[r(e("input",{"onUpdate:modelValue":t[23]||(t[23]=s=>o(n).invoiceParams.carruerType=s),type:"radio",name:"uic-npc",value:o(z).NPC},null,8,Ao),[[f,o(n).invoiceParams.carruerType]]),i(" \u81EA\u7136\u4EBA\u6191\u8B49 ")]),e("label",Bo,[r(e("input",{"onUpdate:modelValue":t[24]||(t[24]=s=>o(n).invoiceParams.carruerType=s),type:"radio",name:"uic-mobile",value:o(z).Mobile},null,8,Eo),[[f,o(n).invoiceParams.carruerType]]),i(" \u624B\u6A5F\u689D\u78BC ")]),o(n).invoiceParams.carruerType>=2?r((k(),N("input",{key:0,id:"inv-carruerNum","onUpdate:modelValue":t[25]||(t[25]=s=>o(n).invoiceParams.carruerNum=s),type:"text",placeholder:"\u8ACB\u8F38\u5165\u5C0D\u61C9\u7684\u8F09\u5177\u7DE8\u865F",class:"form-control",required:"",name:""},null,512)),[[v,o(n).invoiceParams.carruerNum]]):$("",!0)])):$("",!0)])]),e("div",Lo,[zo,r(e("textarea",{id:"","onUpdate:modelValue":t[26]||(t[26]=s=>o(n).consignee.remark=s),rows:"6",placeholder:"\u8ACB\u8F38\u5165\u8A02\u55AE\u5099\u8A3B\u5167\u5BB9",class:"form-control",name:""},null,512),[[v,o(n).consignee.remark]])]),e("div",Ho,[Fo,e("ul",Go,[e("li",null," \u5546\u54C1\u91D1\u984D\u5C0F\u8A08 (\u5171"+g(o(q).length)+"\u9805\u5546\u54C1)\uFF1A$"+g(o(H)),1),e("li",null," \u904B\u8CBB\uFF1A"+g(o(W)),1),e("li",null," \u7D05\u5229\u6263\u9EDE\uFF1A"+g(o(U)),1),e("li",Zo,[i(" \u8A02\u55AE\u7E3D\u91D1\u984D\uFF1A"),e("span",null,"$"+g(o(H)-o(U)+o(W)),1)])])]),e("div",Ko,[e("label",Yo,[r(e("input",{id:"check_service","onUpdate:modelValue":t[27]||(t[27]=s=>T(R)?R.value=s:null),type:"checkbox",required:""},null,512),[[pe,o(R)]]),i(" \u6211\u5DF2\u7D93\u95B1\u8B80\u4E26\u540C\u610F\u4EE5\u4E0A\u8CFC\u8CB7\u9808\u77E5\u3001 "),jo,i("\u8207"),Jo,i("\uFF0C\u6B64\u6B04\u4F4D\u52FE\u9078\u624D\u53EF\u9001\u51FA\u3002 ")])]),Qo,e("div",Wo,[B(Pe,{type:"button",class:"btn btn-main btn-default",to:"/cart"},{default:Y(()=>[i(" \u4E0A\u4E00\u9801 ")]),_:1}),e("input",{id:"",type:"submit",class:"btn btn-main btn-check check_service_btn submit_home",value:"\u78BA\u8A8D\u9001\u51FA",onClick:fe})])])])}}},at=xe(Xo,[["__scopeId","data-v-9922b3c4"]]);export{at as default};
