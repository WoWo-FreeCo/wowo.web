import{j as J,e as Z,u as K,k as Q}from"./entry.713d8cd5.js";import{b as f,c as y,o as W,q as X,_ as b,aa as e,F as ee,V as te,y as o,J as l,ah as v,C as d,G as oe,ae as c,$ as q,i as se,af as k,ab as ne,a0 as ae,a7 as G,f as re,Z as g}from"./swiper-vue.ba6f8b0a.js";import{u as le}from"./authStore.8f7a6b45.js";import{u as ce}from"./cartStore.85040084.js";import{p as ie,q as de}from"./requestURL.06cc9186.js";import{P as h,a as x,D as P}from"./common.b877c4b5.js";const ue={class:"full_height mt185ptb30"},pe={id:"checkout_form",action:"javascript:;",class:"cart_container"},me={class:"cart_list"},he={class:"cart_img"},_e=["src"],ve={class:"cart_tl"},fe={class:"product-quantity"},ye=e("span",null,"\u6EFF\u4EF6\u514D\u904B",-1),be={class:"cart_price text-right"},ke={class:"cart_info"},ge=e("h5",null,"\u5BC4\u9001\u65B9\u5F0F",-1),xe={class:"checkout-form"},Ce={class:"radio form-check"},Pe=["value"],Te={class:"radio form-check"},we=["value"],Ve={class:"cart_info"},Ne=e("h5",null,"\u4ED8\u6B3E\u65B9\u5F0F",-1),Oe={class:"checkout-form"},$e={class:"radio form-check"},Ue=["value"],Be={class:"radio form-check"},Ee=["value"],Re={class:"radio form-check"},Ie=["value"],Le={class:"cart_info"},Ae={class:"checkout-form"},De={id:"ship_home_form",class:"cart_info"},Me=e("h5",null,"\u6536\u4EF6\u4EBA\u8CC7\u8A0A",-1),qe={class:"ship_info"},Ge={key:0,id:"shipday",type:"datetime-local",placeholder:"\u8ACB\u9078\u64C7\u53EF\u6536\u8CA8\u65E5\u671F",class:"form-control",name:""},Se=G('<div class="cart_info checkout-form"><h5>\u767C\u7968\u8CC7\u8A0A</h5><div class="ship_info"><input id="" type="text" placeholder="\u8ACB\u8F38\u5165\u8F09\u5177\u865F\u78BC" class="form-control" name=""></div><label class="checkbox pt10 pb10"><input id="change-image" type="checkbox"> \u767C\u7968\u8981\u6253\u7D71\u7DE8 </label><div class="invoice_form d_none"><h5>\u7D71\u7DE8\u8CC7\u8A0A</h5><div class="ship_info"><input id="" type="text" placeholder="\u7D71\u4E00\u7DE8\u865F*" class="form-control" name=""><input id="" type="text" placeholder="\u767C\u7968\u62AC\u982D*" class="form-control" name=""><input id="" type="email" placeholder="\u767C\u7968\u6536\u53D6E-mail" class="form-control" name=""></div></div></div>',1),Fe={class:"cart_info checkout-form"},He=e("h5",null,"\u8A02\u55AE\u5099\u8A3B",-1),je={class:"cart_info"},ze=e("h5",null,"\u4ED8\u6B3E\u660E\u7D30",-1),Ye={class:"cart_check"},Je={class:"border_top"},Ze=G('<div class="cart_info checkout-form ptb10"><label class="checkbox"><input id="check_service" type="checkbox"> \u6211\u5DF2\u7D93\u95B1\u8B80\u4E26\u540C\u610F\u4EE5\u4E0A\u8CFC\u8CB7\u9808\u77E5\u3001 <a href="/terms" target="new">\u6703\u54E1\u4F7F\u7528\u689D\u6B3E</a>\u8207<a href="/privacy" target="new">\u96B1\u79C1\u6B0A\u653F\u7B56</a>\uFF0C\u6B64\u6B04\u4F4D\u52FE\u9078\u624D\u53EF\u9001\u51FA\u3002 </label></div><div class="text-center mb-20 mt-20"><span id="errormsg"></span></div>',2),Ke={class:"text-center mb-20 mt-20"},nt={__name:"checkout",setup(Qe){var $,U,B,E,R,I,L,A;const S=J(),F=Z(),T=K(),a=le(),p=ce(),_=f(0),u=f(h.General),C=y({get:()=>m.value.reduce((t,s)=>t+O(s)*s.amount,0),set:t=>{C.value=t}}),w=y(()=>{var t;return((t=a==null?void 0:a.user)==null?void 0:t.rewardCredit)||0}),m=y(()=>{switch(u.value){case h.ColdChain:return p==null?void 0:p.merch.filter(t=>t.attribute==="COLD_CHAIN");default:return p==null?void 0:p.merch.filter(t=>t.attribute==="GENERAL")}}),V=f({}),N=y(()=>{var s;const t=(s=V.value)==null?void 0:s.deliveryFee;return t<=0?"\u514D\u904B":t});W(async()=>{if(j(),await X(),m.value<=0)return F.push({path:"/"});await H()});async function H(){try{const t=await $fetch(`${T.public.apiBase}/${ie}`,{method:"POST",body:{attribute:u.value,products:m.value.map(s=>({id:s.id,quantity:s.amount}))},headers:{authorization:"Bearer "+localStorage.getItem("accessToken")}});console.log("pre-settlement, ",t),V.value=t.data}catch{}}function j(){switch(S.query.type){case"cold-chain":u.value=h.ColdChain;break;default:u.value=h.General;break}}const O=t=>{var s,i;return((s=a==null?void 0:a.user)==null?void 0:s.memberLevel)==="SVIP"?t==null?void 0:t.svipPrice:((i=a==null?void 0:a.user)==null?void 0:i.memberLevel)==="VIP"?t==null?void 0:t.vipPrice:a.status.loggedIn?t==null?void 0:t.memberPrice:t==null?void 0:t.price},r=f({attribute:u.value,choosePayment:x.CreditOneTime,consignee:{deliveryType:P.Home,addressDetailOne:($=a.user)==null?void 0:$.addressOne,city:"",district:"",email:(U=a.user)==null?void 0:U.email,idNo:"",idType:"1",cellphone:(B=a.user)==null?void 0:B.cellphone,name:(E=a.user)==null?void 0:E.nickname,province:"",remark:"",senderRemark:"",stationCode:"",stationName:"",town:"",zipCode:""},invoiceParams:{customerName:(R=a.user)==null?void 0:R.nickname,customerEmail:(I=a.user)==null?void 0:I.email,customerPhone:(L=a.user)==null?void 0:L.cellphone,customerAddr:(A=a.user)==null?void 0:A.addressOne,customerIdentifier:"00000000",carruerType:"",carruerNum:"",donation:"0",loveCode:""},products:m.value.map(t=>({id:t.id,quantity:t.amount}))});async function z(){console.log(r.value);try{const t="https://wo.wowo.tw/profile",s=await $fetch(`${T.public.apiBase}/${de}?order_result_url=${t}`,{method:"POST",body:r.value,headers:{authorization:"Bearer "+localStorage.getItem("accessToken")}}),i=document.createElement("credit-div");i.innerHTML=s,i.id="credit-payment",document.body.appendChild(i),document.getElementById("_form_aiochk").submit(),console.log(s)}catch(t){console.log(t)}}return(t,s)=>{const i=re("n-input-number"),Y=Q;return g(),b("div",ue,[e("form",pe,[e("table",me,[e("tbody",null,[(g(!0),b(ee,null,te(o(m),n=>{var D,M;return g(),b("tr",{key:n.id},[e("td",he,[e("img",{src:((D=n==null?void 0:n.thumbnail)==null?void 0:D.url)||"/products/p"+(n.id-10)+".jpg"},null,8,_e)]),e("td",ve,[e("h5",null,c(n==null?void 0:n.name),1),e("div",fe," x"+c(n==null?void 0:n.amount),1),ye]),e("td",be,[e("span",null,"\u5E02\u50F9 $"+c((M=n==null?void 0:n.price)==null?void 0:M.market),1),d(" \u50F9\u9322 $"+c(O(n)),1)])])}),128))])]),e("div",ke,[ge,e("div",xe,[e("label",Ce,[l(e("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>o(r).consignee.deliveryType=n),type:"radio",name:"shipping",value:o(P).Home},null,8,Pe),[[v,o(r).consignee.deliveryType]]),d(" \u5B85\u914D\u5230\u5E9C ")]),l(e("label",Te,[l(e("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>o(r).consignee.deliveryType=n),type:"radio",name:"shipping",value:o(P).Store},null,8,we),[[v,o(r).consignee.deliveryType]]),d(" \u8D85\u5546\u53D6\u8CA8 ")],512),[[oe,o(u)===o(h).General]])])]),e("div",Ve,[Ne,e("div",Oe,[e("label",$e,[l(e("input",{"onUpdate:modelValue":s[2]||(s[2]=n=>o(r).choosePayment=n),type:"radio",name:"payment",value:o(x).CreditOneTime},null,8,Ue),[[v,o(r).choosePayment]]),d(" \u4FE1\u7528\u5361 ")]),e("label",Be,[l(e("input",{"onUpdate:modelValue":s[3]||(s[3]=n=>o(r).choosePayment=n),type:"radio",name:"payment",value:o(x).BarCode},null,8,Ee),[[v,o(r).choosePayment]]),d(" \u8D85\u5546\u689D\u78BC\u4ED8\u6B3E ")]),e("label",Re,[l(e("input",{"onUpdate:modelValue":s[4]||(s[4]=n=>o(r).choosePayment=n),type:"radio",value:o(x).Cvs,name:"payment"},null,8,Ie),[[v,o(r).choosePayment]]),d(" \u8D85\u5546\u4EE3\u78BC\u4ED8\u6B3E ")])])]),e("div",Le,[e("h5",null,"\u7D05\u5229\u6263\u9EDE (\u76EE\u524D\u53EF\u7528\u7D05\u5229\uFF1A"+c(o(w))+" \u9EDE)",1),e("div",Ae,[q(i,{value:o(_),"onUpdate:value":s[5]||(s[5]=n=>se(_)?_.value=n:null),min:"0",max:o(w),style:{width:"150px",margin:"4px 0 4px 15px"}},null,8,["value","max"])])]),e("div",De,[Me,e("div",qe,[l(e("input",{id:"ship_name2","onUpdate:modelValue":s[6]||(s[6]=n=>o(a).user.nickname=n),type:"text",placeholder:"\u59D3\u540D*",class:"form-control",name:""},null,512),[[k,o(a).user.nickname]]),l(e("input",{id:"ship_phone2","onUpdate:modelValue":s[7]||(s[7]=n=>o(a).user.cellphone=n),type:"text",placeholder:"\u624B\u6A5F*",class:"form-control",name:""},null,512),[[k,o(a).user.cellphone]]),l(e("input",{id:"ship_address","onUpdate:modelValue":s[8]||(s[8]=n=>o(a).user.addressOne=n),type:"text",placeholder:"\u5730\u5740*",class:"form-control",name:""},null,512),[[k,o(a).user.addressOne]]),o(u)===o(h).General?(g(),b("input",Ge)):ne("",!0)])]),Se,e("div",Fe,[He,l(e("textarea",{id:"","onUpdate:modelValue":s[9]||(s[9]=n=>o(r).consignee.remark=n),rows:"6",placeholder:"\u8ACB\u8F38\u5165\u8A02\u55AE\u5099\u8A3B\u5167\u5BB9",class:"form-control",name:""},null,512),[[k,o(r).consignee.remark]])]),e("div",je,[ze,e("ul",Ye,[e("li",null," \u5546\u54C1\u91D1\u984D\u5C0F\u8A08 (\u5171"+c(o(m).length)+"\u9805\u5546\u54C1)\uFF1A$"+c(o(C)),1),e("li",null," \u904B\u8CBB\uFF1A"+c(o(N)),1),e("li",null," \u7D05\u5229\u6263\u9EDE\uFF1A"+c(o(_)),1),e("li",Je,[d(" \u8A02\u55AE\u7E3D\u91D1\u984D\uFF1A"),e("span",null,"$"+c(o(C)-o(_)+o(N)),1)])])]),Ze,e("div",Ke,[q(Y,{type:"button",class:"btn btn-main btn-default",to:"/cart"},{default:ae(()=>[d(" \u4E0A\u4E00\u9801 ")]),_:1}),e("input",{id:"",type:"submit",class:"btn btn-main btn-check check_service_btn submit_home",value:"\u78BA\u8A8D\u9001\u51FA",onClick:z})])])])}}};export{nt as default};
