import{a as se,j as ae,e as ne,b as le,u as ce,k as re}from"./entry.27c155a0.js";import{b as k,c as T,o as ie,q as de,P as ue,_ as w,aa as e,F as pe,V as me,y as t,J as c,ah as x,C as d,G as $,ae as i,$ as Y,i as _e,af as f,ab as he,a0 as ve,a7 as J,f as fe,Z as I,a8 as be,a9 as ye}from"./swiper-vue.ba6f8b0a.js";import{u as ge}from"./authStore.163d7370.js";import{u as ke}from"./cartStore.42d3b07f.js";import{p as xe,q as Ce}from"./requestURL.06cc9186.js";import{P as b,a as V,D as U}from"./common.b877c4b5.js";const m=C=>(be("data-v-46bce3f4"),C=C(),ye(),C),Pe={class:"full_height mt185ptb30"},Te={id:"checkout_form",action:"javascript:;",class:"cart_container"},we={class:"cart_list"},Ie={class:"cart_img"},Ve=["src"],Ue={class:"cart_tl"},Ne={class:"product-quantity"},Se=m(()=>e("span",null,"\u6EFF\u4EF6\u514D\u904B",-1)),$e={class:"cart_price text-right"},Oe={class:"cart_info"},Le=m(()=>e("h5",null,"\u5BC4\u9001\u65B9\u5F0F",-1)),Re={class:"checkout-form"},Ee={class:"radio form-check"},Be=["value"],Me={class:"radio form-check"},Ae=["value"],De={class:"cart_info"},qe=m(()=>e("h5",null,"\u4ED8\u6B3E\u65B9\u5F0F",-1)),Ge={class:"checkout-form"},Fe={class:"radio form-check"},He=["value"],je={class:"radio form-check"},ze=["value"],Ye={class:"radio form-check"},Je=["value"],Ze={class:"cart_info"},Ke={class:"checkout-form"},Qe={id:"ship_home_form",class:"cart_info"},We=m(()=>e("h5",null,"\u6536\u4EF6\u4EBA\u8CC7\u8A0A",-1)),Xe={class:"ship_info"},et={key:0,id:"shipday",type:"datetime-local",placeholder:"\u8ACB\u9078\u64C7\u53EF\u6536\u8CA8\u65E5\u671F",class:"form-control",name:""},tt={class:"cart_info checkout-form"},ot=m(()=>e("h5",null,"\u8D85\u5546\u53D6\u8CA8\u8CC7\u8A0A",-1)),st={class:"ship_info"},at={class:"ship_info"},nt=J('<div class="cart_info checkout-form" data-v-46bce3f4><h5 data-v-46bce3f4>\u767C\u7968\u8CC7\u8A0A</h5><div class="ship_info" data-v-46bce3f4><input id="" type="text" placeholder="\u8ACB\u8F38\u5165\u8F09\u5177\u865F\u78BC" class="form-control" name="" data-v-46bce3f4></div><label class="checkbox pt10 pb10" data-v-46bce3f4><input id="change-image" type="checkbox" data-v-46bce3f4> \u767C\u7968\u8981\u6253\u7D71\u7DE8 </label><div class="invoice_form d_none" data-v-46bce3f4><h5 data-v-46bce3f4>\u7D71\u7DE8\u8CC7\u8A0A</h5><div class="ship_info" data-v-46bce3f4><input id="" type="text" placeholder="\u7D71\u4E00\u7DE8\u865F*" class="form-control" name="" data-v-46bce3f4><input id="" type="text" placeholder="\u767C\u7968\u62AC\u982D*" class="form-control" name="" data-v-46bce3f4><input id="" type="email" placeholder="\u767C\u7968\u6536\u53D6E-mail" class="form-control" name="" data-v-46bce3f4></div></div></div>',1),lt={class:"cart_info checkout-form"},ct=m(()=>e("h5",null,"\u8A02\u55AE\u5099\u8A3B",-1)),rt={class:"cart_info"},it=m(()=>e("h5",null,"\u4ED8\u6B3E\u660E\u7D30",-1)),dt={class:"cart_check"},ut={class:"border_top"},pt=J('<div class="cart_info checkout-form ptb10" data-v-46bce3f4><label class="checkbox" data-v-46bce3f4><input id="check_service" type="checkbox" data-v-46bce3f4> \u6211\u5DF2\u7D93\u95B1\u8B80\u4E26\u540C\u610F\u4EE5\u4E0A\u8CFC\u8CB7\u9808\u77E5\u3001 <a href="/terms" target="new" data-v-46bce3f4>\u6703\u54E1\u4F7F\u7528\u689D\u6B3E</a>\u8207<a href="/privacy" target="new" data-v-46bce3f4>\u96B1\u79C1\u6B0A\u653F\u7B56</a>\uFF0C\u6B64\u6B04\u4F4D\u52FE\u9078\u624D\u53EF\u9001\u51FA\u3002 </label></div><div class="text-center mb-20 mt-20" data-v-46bce3f4><span id="errormsg" data-v-46bce3f4></span></div>',2),mt={class:"text-center mb-20 mt-20"},_t={__name:"checkout",setup(C){var B,M,A,D,q,G,F,H;const Z=ae(),K=ne(),Q=le(),P=ce(),n=ge(),_=ke(),y=k(0),u=k(b.General),N=T({get:()=>h.value.reduce((s,a)=>s+E(a)*a.amount,0),set:s=>{N.value=s}}),O=T(()=>{var s;return((s=n==null?void 0:n.user)==null?void 0:s.rewardCredit)||0}),h=T(()=>{switch(u.value){case b.ColdChain:return _==null?void 0:_.merch.filter(s=>s.attribute==="COLD_CHAIN");default:return _==null?void 0:_.merch.filter(s=>s.attribute==="GENERAL")}}),L=k({}),r=k({name:"",id:"",outside:0,ship:0,address:""}),R=T(()=>{var a;const s=(a=L.value)==null?void 0:a.deliveryFee;return s<=0?"\u514D\u904B":s});let S=null;ie(async()=>{if(ee(),await de(),h.value<=0)return K.push({path:"/"});await W(),S=setInterval(()=>{X()},1e3)}),ue(()=>{clearInterval(S),S=null});async function W(){try{const s=await $fetch(`${P.public.apiBase}/${xe}`,{method:"POST",body:{attribute:u.value,products:h.value.map(a=>({id:a.id,quantity:a.amount}))},headers:{authorization:"Bearer "+localStorage.getItem("accessToken")}});console.log("pre-settlement, ",s),L.value=s.data}catch{}}function X(){r.value.name=localStorage.getItem("storename"),r.value.id=localStorage.getItem("storeid"),r.value.address=localStorage.getItem("storeaddress"),r.value.ship=localStorage.getItem("ship"),r.value.outside=localStorage.getItem("outside")}function ee(){switch(Z.query.type){case"cold-chain":u.value=b.ColdChain;break;default:u.value=b.General;break}}const E=s=>{var a,p;return((a=n==null?void 0:n.user)==null?void 0:a.memberLevel)==="SVIP"?s==null?void 0:s.svipPrice:((p=n==null?void 0:n.user)==null?void 0:p.memberLevel)==="VIP"?s==null?void 0:s.vipPrice:n.status.loggedIn?s==null?void 0:s.memberPrice:s==null?void 0:s.price},l=k({attribute:u.value,choosePayment:V.CreditOneTime,consignee:{deliveryType:U.Home,addressDetailOne:(B=n.user)==null?void 0:B.addressOne,city:"",district:"",email:(M=n.user)==null?void 0:M.email,idNo:"",idType:"1",cellphone:(A=n.user)==null?void 0:A.cellphone,name:(D=n.user)==null?void 0:D.nickname,province:"",remark:"",senderRemark:"",stationCode:"",stationName:"",town:"",zipCode:""},invoiceParams:{customerName:(q=n.user)==null?void 0:q.nickname,customerEmail:(G=n.user)==null?void 0:G.email,customerPhone:(F=n.user)==null?void 0:F.cellphone,customerAddr:(H=n.user)==null?void 0:H.addressOne,customerIdentifier:"00000000",carruerType:"",carruerNum:"",donation:"0",loveCode:""},products:h.value.map(s=>({id:s.id,quantity:s.amount}))});async function te(){var a,p;const s={...l.value,consignee:{...l.value.consignee,stationCode:(a=r.value)==null?void 0:a.id,stationName:(p=r.value)==null?void 0:p.name}};console.log(s);try{const g=`${P.public.baseUrl}/order?payment=successful`,o=await $fetch(`${P.public.apiBase}/${Ce}?order_result_url=${g}`,{method:"POST",body:s,headers:{authorization:"Bearer "+localStorage.getItem("accessToken")}});Q.loading("\u5373\u5C07\u5C0E\u5411\u4ED8\u6B3E\u9801\u9762\uFF0C\u8ACB\u7A0D\u5019...");const v=document.createElement("credit-div");v.innerHTML=o,v.id="credit-payment",document.body.appendChild(v),document.getElementById("_form_aiochk").submit(),console.log(o)}catch(g){console.log(g)}}function oe(){const s=`${P.public.baseUrl}`;window.open(`https://emap.presco.com.tw/c2cemap.ashx?eshopid=870&&servicetype=1&url=${s}/cvs_callback`)}return(s,a)=>{const p=fe("n-input-number"),g=re;return I(),w("div",Pe,[e("form",Te,[e("table",we,[e("tbody",null,[(I(!0),w(pe,null,me(t(h),o=>{var v,j,z;return I(),w("tr",{key:o.id,class:"prod-tr"},[e("td",Ie,[e("img",{src:((v=o==null?void 0:o.thumbnail)==null?void 0:v.url)||"/products/p"+(o.id-10)+".jpg"},null,8,Ve)]),e("td",Ue,[e("h5",null,i(o==null?void 0:o.name),1),e("div",Ne," x"+i(o==null?void 0:o.amount),1),Se]),e("td",$e,[c(e("span",null,"\u5E02\u50F9 $"+i(o==null?void 0:o.price),513),[[$,((j=t(n).user)==null?void 0:j.memberLevel)&&((z=t(n).user)==null?void 0:z.memberLevel)!=="NORMAL"]]),d(" \u50F9\u9322 $"+i(E(o)),1)])])}),128))])]),e("div",Oe,[Le,e("div",Re,[e("label",Ee,[c(e("input",{"onUpdate:modelValue":a[0]||(a[0]=o=>t(l).consignee.deliveryType=o),type:"radio",name:"shipping",value:t(U).Home},null,8,Be),[[x,t(l).consignee.deliveryType]]),d(" \u5B85\u914D\u5230\u5E9C ")]),c(e("label",Me,[c(e("input",{"onUpdate:modelValue":a[1]||(a[1]=o=>t(l).consignee.deliveryType=o),type:"radio",name:"shipping",value:t(U).Store},null,8,Ae),[[x,t(l).consignee.deliveryType]]),d(" \u8D85\u5546\u53D6\u8CA8 ")],512),[[$,t(u)===t(b).General]])])]),e("div",De,[qe,e("div",Ge,[e("label",Fe,[c(e("input",{"onUpdate:modelValue":a[2]||(a[2]=o=>t(l).choosePayment=o),type:"radio",name:"payment",value:t(V).CreditOneTime},null,8,He),[[x,t(l).choosePayment]]),d(" \u4FE1\u7528\u5361 ")]),e("label",je,[c(e("input",{"onUpdate:modelValue":a[3]||(a[3]=o=>t(l).choosePayment=o),type:"radio",name:"payment",value:t(V).BarCode},null,8,ze),[[x,t(l).choosePayment]]),d(" \u8D85\u5546\u689D\u78BC\u4ED8\u6B3E ")]),e("label",Ye,[c(e("input",{"onUpdate:modelValue":a[4]||(a[4]=o=>t(l).choosePayment=o),type:"radio",value:t(V).Cvs,name:"payment"},null,8,Je),[[x,t(l).choosePayment]]),d(" \u8D85\u5546\u4EE3\u78BC\u4ED8\u6B3E ")])])]),e("div",Ze,[e("h5",null,"\u7D05\u5229\u6263\u9EDE (\u76EE\u524D\u53EF\u7528\u7D05\u5229\uFF1A"+i(t(O))+" \u9EDE)",1),e("div",Ke,[Y(p,{value:t(y),"onUpdate:value":a[5]||(a[5]=o=>_e(y)?y.value=o:null),min:"0",max:t(O),style:{width:"150px",margin:"4px 0 4px 15px"}},null,8,["value","max"])])]),e("div",Qe,[We,e("div",Xe,[c(e("input",{id:"ship_name2","onUpdate:modelValue":a[6]||(a[6]=o=>t(n).user.nickname=o),type:"text",placeholder:"\u59D3\u540D*",class:"form-control",name:""},null,512),[[f,t(n).user.nickname]]),c(e("input",{id:"ship_phone2","onUpdate:modelValue":a[7]||(a[7]=o=>t(n).user.cellphone=o),type:"text",placeholder:"\u624B\u6A5F*",class:"form-control",name:""},null,512),[[f,t(n).user.cellphone]]),c(e("input",{id:"ship_address","onUpdate:modelValue":a[8]||(a[8]=o=>t(n).user.addressOne=o),type:"text",placeholder:"\u5730\u5740*",class:"form-control",name:""},null,512),[[f,t(n).user.addressOne]]),t(u)===t(b).General?(I(),w("input",et)):he("",!0)])]),c(e("div",tt,[ot,e("div",{class:"ship_info"},[e("button",{onClick:oe}," \u9078\u64C7\u5E97\u8216 ")]),e("div",st,[c(e("input",{id:"store-name","onUpdate:modelValue":a[9]||(a[9]=o=>t(r).name=o),type:"text",class:"form-control bold",disabled:""},null,512),[[f,t(r).name]])]),e("div",at,[c(e("input",{id:"store-address","onUpdate:modelValue":a[10]||(a[10]=o=>t(r).address=o),type:"text",class:"form-control bold",disabled:""},null,512),[[f,t(r).address]])])],512),[[$,t(l).consignee.deliveryType===t(U).Store]]),nt,e("div",lt,[ct,c(e("textarea",{id:"","onUpdate:modelValue":a[11]||(a[11]=o=>t(l).consignee.remark=o),rows:"6",placeholder:"\u8ACB\u8F38\u5165\u8A02\u55AE\u5099\u8A3B\u5167\u5BB9",class:"form-control",name:""},null,512),[[f,t(l).consignee.remark]])]),e("div",rt,[it,e("ul",dt,[e("li",null," \u5546\u54C1\u91D1\u984D\u5C0F\u8A08 (\u5171"+i(t(h).length)+"\u9805\u5546\u54C1)\uFF1A$"+i(t(N)),1),e("li",null," \u904B\u8CBB\uFF1A"+i(t(R)),1),e("li",null," \u7D05\u5229\u6263\u9EDE\uFF1A"+i(t(y)),1),e("li",ut,[d(" \u8A02\u55AE\u7E3D\u91D1\u984D\uFF1A"),e("span",null,"$"+i(t(N)-t(y)+t(R)),1)])])]),pt,e("div",mt,[Y(g,{type:"button",class:"btn btn-main btn-default",to:"/cart"},{default:ve(()=>[d(" \u4E0A\u4E00\u9801 ")]),_:1}),e("input",{id:"",type:"submit",class:"btn btn-main btn-check check_service_btn submit_home",value:"\u78BA\u8A8D\u9001\u51FA",onClick:te})])])])}}},kt=se(_t,[["__scopeId","data-v-46bce3f4"]]);export{kt as default};
